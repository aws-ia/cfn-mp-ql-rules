{"AWSTemplateFormatVersion": "2010-09-09", "Description": "Deploy SAP Additional Application Server (qs-1no61sjl2)", "Metadata": {"AWSAMIRegionMap": {"Filters": {"SLES12SP2SAPHVM": {"name": "*-e3458d64-5c36-4577-bd98-0ee19e3eaeec-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "SLES12SP3SAPHVM": {"name": "*-da7aa9c3-97db-4573-89a6-7fe7348d90b0-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}}}, "AWS::CloudFormation::Interface": {"ParameterGroups": [{"Label": {"default": "Existing network infrastructure details"}, "Description": {"default": ""}, "Parameters": ["VPCID", "PrivateSubnet1CIDR", "PrivateSubnet2CIDR", "PublicSubnet1CIDR", "PublicSubnet2CIDR", "PrivateSubnetID"]}, {"Label": {"default": "Server and storage configuration"}, "Description": {"default": ""}, "Parameters": ["KeyName"]}, {"Label": {"default": "SAP App Server setup and configuration"}, "Description": {"default": ""}, "Parameters": ["DistributedInstall", "EFSSapmnt", "EFSFSName", "HostedZoneName", "HostedZoneID", "SAPASCSHostname", "SAPPASHostname", "SAPHANAHostname", "SAPAASHostname", "SID", "SAPSchemaName", "SAPInstanceNum", "SIDadmUID", "SAPTZ", "SAPNetWeaverPassSSMParamName", "MyOS", "SLESBYOSRegCode", "MyInstanceType", "AutoRecovery", "InstallSAP", "InstallSAPVersion"]}, {"Label": {"default": "Advanced configuration (Do not modify unless directed by AWS Support)"}, "Description": {"default": ""}, "Parameters": ["QSS3BucketName", "QSS3KeyPrefix"]}], "ParameterLabels": {"AutoRecovery": {"default": "EC2 Auto Recovery"}, "DistributedInstall": {"default": "The ASCS and PAS are split(i.e. Distributed installation)"}, "EFSFSName": {"default": "Existing EFS fs name"}, "EFSSapmnt": {"default": "Use EFS for /sapmnt"}, "HostedZoneName": {"default": "Existing R53 private hosted zone name"}, "InstallSAP": {"default": "Install SAP software"}, "InstallSAPVersion": {"default": "SAP S/4HANA version"}, "KeyName": {"default": "SSH key pair"}, "MyInstanceType": {"default": "Choose instance type"}, "MyOS": {"default": "O.S. version for SAP Servers"}, "PrivateSubnetID": {"default": "Private Subnet ID"}, "PrivateSubnet1CIDR": {"default": "Private Subnet 1 CIDR"}, "PrivateSubnet2CIDR": {"default": "Private Subnet 2 CIDR"}, "PublicSubnet1CIDR": {"default": "Public Subnet 1 CIDR"}, "PublicSubnet2CIDR": {"default": "Public Subnet 2 CIDR"}, "QSS3BucketName": {"default": "S3 bucket name for the Quick Start assets."}, "QSS3KeyPrefix": {"default": "S3 key prefix for the Quick Start assets"}, "SAPASCSHostname": {"default": "SAP ASCS Server hostname"}, "SAPAASHostname": {"default": "SAP AAS Server hostname"}, "SAPHANAHostname": {"default": "SAP HANA Server hostname"}, "SAPInstanceNum": {"default": "SAP instance number"}, "SAPNetWeaverPassSSMParamName": {"default": "Existing EC2 SSM parameter store name"}, "SAPPASHostname": {"default": "SAP PAS server hostname"}, "SAPTZ": {"default": "SAP Server timezone"}, "SAPSchemaName": {"default": "SAP database schema"}, "SID": {"default": "SAP system ID"}, "SIDadmUID": {"default": "SIDadm user id"}, "SLESBYOSRegCode": {"default": "Enter SUSE BYOS Registration Code"}, "VPCID": {"default": "Choose VPC ID"}}}}, "Parameters": {"AutoRecovery": {"Type": "String", "Description": "EC2 Automatic recovery feature", "Default": "Yes", "AllowedValues": ["Yes", "No"]}, "DistributedInstall": {"Description": "ASCS and PAS are distr. onto 2 different instances", "Default": "No", "Type": "String", "AllowedValues": ["Yes", "No"]}, "EFSSapmnt": {"AllowedValues": ["Yes", "No"], "Default": "No", "Description": "Enable (Yes) or disable (No) EFS for /sapmnt.", "Type": "String"}, "EFSFSName": {"Description": "An *existing* EFS filesystem name.", "Default": "efs-fsname", "Type": "String"}, "HostedZoneID": {"Description": "Id. of an *existing* R53 privated hosted zone.", "Type": "AWS::Route53::HostedZone::Id"}, "HostedZoneName": {"Description": "An *existing* R53 privated hosted zone name e.g. mycompany.local. Hint: See name in Zone Id.", "Type": "String", "MinLength": "1", "MaxLength": "64", "AllowedPattern": "(?!-)[a-zA-Z0-9-.]*(?<!-)", "ConstraintDescription": "must be a valid fully-qualified domain name."}, "InstallSAP": {"AllowedValues": ["Yes", "No"], "Default": "Yes", "Description": "Install (Yes) or don't install (No) SAP Autoscaling App Servers. When set to No, *only* AWS infrastructure is provisioned.", "Type": "String"}, "InstallSAPVersion": {"Type": "String", "Description": "SAP S/4HANA version to install.", "Default": "S/4HANA-1809", "AllowedValues": ["S/4HANA-1809"]}, "KeyName": {"Description": "Name of an existing Amazon EC2 key pair. All instances will launched with this key pair.", "Type": "AWS::EC2::KeyPair::KeyName"}, "MyInstanceType": {"AllowedValues": ["r4.4xlarge", "r4.2xlarge", "r4.xlarge", "r4.large", "r5.4xlarge", "r5.2xlarge", "r5.xlarge", "r5.large", "m4.4xlarge", "m4.2xlarge", "m4.xlarge", "m4.large", "m5.4xlarge", "m5.2xlarge", "m5.xlarge", "m5.large", "c4.4xlarge", "c4.2xlarge", "c4.xlarge", "c4.large", "c5.4xlarge", "c5.2xlarge", "c5.xlarge", "c5.large"], "Default": "r5.xlarge", "Description": "Instance type for SAP Servers.", "Type": "String"}, "MyOS": {"AllowedValues": ["Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM", "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM", "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM", "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM", "SuSE-Linux-11-SP4-HVM", "SuSE-Linux-12-SP1-HVM", "SuSE-Linux-12-SP2-HVM", "SuSE-Linux-12-SP3-HVM", "SuSE-Linux-12-SP4-HVM", "SuSE-Linux-15-HVM", "SuSE-Linux-12-SP2-For-SAP-HVM", "SuSE-Linux-12-SP3-For-SAP-HVM", "SuSE-Linux-12-SP4-For-SAP-HVM", "SuSE-Linux-15-For-SAP-HVM", "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM", "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM", "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM", "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM", "SuSE-Linux-15-For-SAP-BYOS-HVM"], "Default": "SuSE-Linux-12-SP4-For-SAP-HVM", "Description": "Operating system version for SAP servers.", "Type": "String"}, "PrivateSubnetID": {"Description": "Private subnet to deploy SAP Additional App Server.", "Type": "AWS::EC2::Subnet::Id"}, "PrivateSubnet1CIDR": {"AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$", "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28", "Default": "10.0.0.0/19", "Description": "CIDR block for private subnet 1 located in Availability Zone 1", "Type": "String"}, "PrivateSubnet2CIDR": {"AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$", "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28", "Default": "10.0.32.0/19", "Description": "CIDR block for private subnet 2 located in Availability Zone 2", "Type": "String"}, "PublicSubnet1CIDR": {"AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$", "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28", "Default": "10.0.128.0/20", "Description": "CIDR block for the public (DMZ) subnet 1 located in Availability Zone 1", "Type": "String"}, "PublicSubnet2CIDR": {"AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$", "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28", "Default": "10.0.144.0/20", "Description": "CIDR block for the public (DMZ) subnet 2 located in Availability Zone 2", "Type": "String"}, "QSS3BucketName": {"AllowedPattern": "^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$", "ConstraintDescription": "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).", "Default": "aws-quickstart", "Description": "S3 bucket name for the Quick Start assets. This string can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).", "Type": "String"}, "QSS3KeyPrefix": {"AllowedPattern": "^[0-9a-zA-Z-/]*$", "ConstraintDescription": "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).", "Default": "quickstart-sap-s4hana/", "Description": "S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).", "Type": "String"}, "SAPAASHostname": {"Default": "sidapp00", "Description": "Host name to use for SAP AAS Server.", "Type": "String"}, "SAPHANAHostname": {"Default": "siddbmas", "Description": "Host name to use for SAP HANA database (SAP App server must be able to access HANA server).", "Type": "String"}, "SAPInstanceNum": {"AllowedPattern": "([0-8]{1}[0-9]{1}|[9]{1}[0-7]{1})", "Default": "00", "Description": "SAP instance number to use for installation and setup, and to open ports for security groups.", "Type": "String"}, "SAPNetWeaverPassSSMParamName": {"AllowedPattern": "^(?!ssm).*$", "ConstraintDescription": "Name of *existing* SSM  parameter store can *not* begin with ssm.", "Description": "Name of *existing* EC2 SSM  parameter store. The encrypted master password is stored in the SSM parameter store", "MinLength": "1", "NoEcho": "false", "Type": "String"}, "SAPASCSHostname": {"Default": "sidasc00", "Description": "Existing SAP ASCS server's hostname.", "Type": "String"}, "SAPPASHostname": {"Default": "sidpas00", "Description": "Host name to use for SAP PAS Server (DNS short name). Can be the same as the ASCS server", "Type": "String"}, "SAPTZ": {"AllowedValues": ["PT", "CT", "ET", "UC"], "ConstraintDescription": "This value must consist of 2 characters.", "Default": "UC", "Description": "The TimeZone of your SAP Server (PT, CT, ET, or UTC)", "Type": "String"}, "SAPSchemaName": {"Default": "SAPHANADB", "Description": "SAP ABAP Schema name for HANA database .", "Type": "String"}, "SID": {"AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})", "ConstraintDescription": "This value must consist of 3 characters.", "Default": "HDB", "Description": "SAP system ID for installation and setup.", "Type": "String"}, "SIDadmUID": {"Default": "1002", "Description": "UID (default is 1002) for the SIDadm user.", "Type": "String"}, "SLESBYOSRegCode": {"Type": "String", "Default": "", "Description": "Registration code for SUSE BYOS (Applicable only if you use BYOS Option)."}, "VPCID": {"Description": "The existing Amazon VPC where you want to deploy SAP App Server Cluster.", "Type": "AWS::EC2::VPC::Id"}}, "Conditions": {"AutoRecoveryMaster": {"Fn::Equals": [{"Ref": "AutoRecovery"}, "Yes"]}}, "Mappings": {"SAPHANAOSNameMap": {"Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM": {"Code": "RedHatLinux75ForSAP"}, "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM": {"Code": "RedHatLinux74ForSAP-With-HA-US"}, "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM": {"Code": "RedHatLinux75ForSAP-With-HA-US"}, "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM": {"Code": "RedHatLinux76ForSAP-With-HA-US"}, "SuSE-Linux-11-SP4-HVM": {"Code": "SuSELinux11SP4"}, "SuSE-Linux-12-SP1-HVM": {"Code": "SuSELinux12SP1"}, "SuSE-Linux-12-SP2-HVM": {"Code": "SuSELinux12SP2"}, "SuSE-Linux-12-SP3-HVM": {"Code": "SuSELinux12SP3"}, "SuSE-Linux-12-SP4-HVM": {"Code": "SuSELinux12SP4"}, "SuSE-Linux-15-HVM": {"Code": "SuSELinux15"}, "SuSE-Linux-12-SP2-For-SAP-HVM": {"Code": "SuSELinux12SP2ForSAP"}, "SuSE-Linux-12-SP3-For-SAP-HVM": {"Code": "SuSELinux12SP3ForSAP"}, "SuSE-Linux-12-SP4-For-SAP-HVM": {"Code": "SuSELinux12SP4ForSAP"}, "SuSE-Linux-15-For-SAP-HVM": {"Code": "SuSELinux15ForSAP"}, "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM": {"Code": "SuSELinux12SP1ForSAP-BYOS"}, "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM": {"Code": "SuSELinux12SP2ForSAP-BYOS"}, "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM": {"Code": "SuSELinux12SP3ForSAP-BYOS"}, "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM": {"Code": "SuSELinux12SP4ForSAP-BYOS"}, "SuSE-Linux-15-For-SAP-BYOS-HVM": {"Code": "SuSELinux15ForSAP-BYOS"}}, "SAPAMINameMap": {"Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM": {"Code": "RHEL75SAPHVM"}, "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM": {"Code": "RHEL74SAPHAUSHVM"}, "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM": {"Code": "RHEL75SAPHAUSHVM"}, "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM": {"Code": "RHEL76SAPHAUSHVM"}, "SuSE-Linux-11-SP4-HVM": {"Code": "SLES11SP4HVM"}, "SuSE-Linux-12-HVM": {"Code": "SLES12HVM"}, "SuSE-Linux-12-SP1-HVM": {"Code": "SLES12SP1HVM"}, "SuSE-Linux-12-SP2-HVM": {"Code": "SLES12SP2HVM"}, "SuSE-Linux-12-SP3-HVM": {"Code": "SLES12SP3HVM"}, "SuSE-Linux-12-SP4-HVM": {"Code": "SLES12SP4HVM"}, "SuSE-Linux-15-HVM": {"Code": "SLES15HVM"}, "SuSE-Linux-12-SP2-For-SAP-HVM": {"Code": "SLES12SP2SAPHVM"}, "SuSE-Linux-12-SP3-For-SAP-HVM": {"Code": "SLES12SP3SAPHVM"}, "SuSE-Linux-12-SP4-For-SAP-HVM": {"Code": "SLES12SP4SAPHVM"}, "SuSE-Linux-15-For-SAP-HVM": {"Code": "SLES15SAPHVM"}, "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM": {"Code": "SLES12SP1SAPBYOSHVM"}, "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM": {"Code": "SLES12SP2SAPBYOSHVM"}, "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM": {"Code": "SLES12SP3SAPBYOSHVM"}, "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM": {"Code": "SLES12SP4SAPBYOSHVM"}, "SuSE-Linux-15-For-SAP-BYOS-HVM": {"Code": "SLES15SAPBYOSHVM"}}, "AWSAMIRegionMap": {"AMI": {"RHEL75SAPHVM": "SAP-7.5_HVM_GA-20180911-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-ami-01e5a531ae8d3d976.4", "RHEL74SAPHAUSHVM": "SAPHAE4S-7.4_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0c3e857ffeab71ac5.4", "RHEL75SAPHAUSHVM": "SAPHAEUS-7.5_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-081c0b27c08752050.4", "RHEL76SAPHAUSHVM": "SAP-7.6_E4S_HA_US_HVM-20190221-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0e49c67162a6956e9.4", "SLES11SP4HVM": "suse-sles-11-sp4-v20180816-hvm-ssd-x86_64", "SLES12SP1HVM": "suse-sles-12-sp1-v20161021-hvm-ssd-x86_64", "SLES12SP2HVM": "suse-sles-12-sp2-v20170620-hvm-ssd-x86_64", "SLES12SP3HVM": "suse-sles-12-sp3-v20181004-hvm-ssd-x86_64", "SLES12SP4HVM": "suse-sles-12-sp4-v20190314-hvm-ssd-x86_64", "SLES15HVM": "suse-sles-15-v20180806-hvm-ssd-x86_64", "SLES12SP2SAPHVM": "suse-sles-sap-12-sp2-v20180706-hvm-ssd-x86_64-e3458d64-5c36-4577-bd98-0ee19e3eaeec-ami-3ac5ea45.4", "SLES12SP3SAPHVM": "suse-sles-sap-12-sp3-v20180814-hvm-ssd-x86_64-da7aa9c3-97db-4573-89a6-7fe7348d90b0-ami-0df5b06332b816a8e.4", "SLES12SP4SAPHVM": "suse-sles-sap-12-sp4-v20181212-hvm-ssd-x86_64-8f7bb679-fb90-4446-aa80-9b6cfd834710-ami-015bf44384c484ccb.4", "SLES15SAPHVM": "suse-sles-sap-15-v20180806-hvm-ssd-x86_64-6a4bc5af-a084-4f96-8402-5cd249e9091d-ami-06aee2e6db735d4f4.4", "SLES12SP1SAPBYOSHVM": "suse-sles-sap-12-sp1-byos-v20170123-hvm-ssd-x86_64", "SLES12SP2SAPBYOSHVM": "suse-sles-sap-12-sp2-byos-v20180816-hvm-ssd-x86_64", "SLES12SP3SAPBYOSHVM": "suse-sles-sap-12-sp3-byos-v20180814-hvm-ssd-x86_64", "SLES12SP4SAPBYOSHVM": "suse-sles-sap-12-sp4-byos-v20190314-hvm-ssd-x86_64", "SLES15SAPBYOSHVM": "suse-sles-sap-15-byos-v20180816-hvm-ssd-x86_64", "WS2012R2": "Windows_Server-2012-R2_RTM-English-64Bit-Base-2019.05.15"}, "ap-northeast-1": {"RHEL75SAPHVM": "ami-0ce47f39a0a21f61e", "RHEL74SAPHAUSHVM": "ami-0033f0d7d626f014f", "RHEL75SAPHAUSHVM": "ami-08d13c2bb0c07e8e3", "RHEL76SAPHAUSHVM": "ami-092eb64b443171d7e", "SLES11SP4HVM": "ami-0c6f393bb8d20159a", "SLES12SP1HVM": "ami-d94fe9b8", "SLES12SP1SAPBYOSHVM": "ami-63473c04", "SLES12SP2HVM": "ami-a07560c7", "SLES12SP2SAPBYOSHVM": "ami-0cd358eaaf4cfca8f", "SLES12SP2SAPHVM": "ami-322e43df", "SLES12SP3HVM": "ami-050f5170e43607893", "SLES12SP3SAPBYOSHVM": "ami-046ba88845aa11793", "SLES12SP3SAPHVM": "ami-04f2b176779a2ef98", "SLES12SP4HVM": "ami-01f9388175dab7707", "SLES12SP4SAPBYOSHVM": "ami-0f23448ff16bda87c", "SLES12SP4SAPHVM": "ami-0ec6698d9e168a529", "SLES15HVM": "ami-056ac8ad44e6a7e1f", "SLES15SAPHVM": "ami-04006981f43b284b9", "SLES15SAPBYOSHVM": "ami-0a283a879655ea8ad", "WS2012R2": "ami-0da4d2aec4faf903c"}, "ap-northeast-2": {"RHEL75SAPHVM": "ami-06db50be1842d6b9a", "RHEL74SAPHAUSHVM": "ami-0450ac5a5b079fa41", "RHEL75SAPHAUSHVM": "ami-0521b6ebbf151e58a", "RHEL76SAPHAUSHVM": "ami-04384779af6b49648", "SLES11SP4HVM": "ami-00e7068674ce94853", "SLES12SP1HVM": "ami-1ced3972", "SLES12SP1SAPBYOSHVM": "ami-b5f928db", "SLES12SP2HVM": "ami-86d00fe8", "SLES12SP2SAPBYOSHVM": "ami-0aa17e547c74ef870", "SLES12SP2SAPHVM": "ami-241fab4a", "SLES12SP3HVM": "ami-00728f974fb4b3f2a", "SLES12SP3SAPBYOSHVM": "ami-0dae09c444db95f79", "SLES12SP3SAPHVM": "ami-0107d891c218beaa0", "SLES12SP4HVM": "ami-05114ac18a716bc1c", "SLES12SP4SAPBYOSHVM": "ami-028abd488e2c2f400", "SLES12SP4SAPHVM": "ami-0cf27fcc8aef42b17", "SLES15HVM": "ami-0f81fff879bafe6b8", "SLES15SAPHVM": "ami-0dcd1a1bea1fb1123", "SLES15SAPBYOSHVM": "ami-0cc04512ca5fb8d7c", "WS2012R2": "ami-0736fa421b03ebc0b"}, "ap-south-1": {"RHEL75SAPHVM": "ami-0afdd099cb4cacadf", "RHEL74SAPHAUSHVM": "ami-0167ffd4ebf2c034a", "RHEL75SAPHAUSHVM": "ami-029b2a9859384e194", "RHEL76SAPHAUSHVM": "ami-015afb3901ab40784", "SLES11SP4HVM": "ami-0bdb8670f707feabd", "SLES12SP1HVM": "ami-985226f7", "SLES12SP1SAPBYOSHVM": "ami-93c9bffc", "SLES12SP2HVM": "ami-62e39c0d", "SLES12SP2SAPBYOSHVM": "ami-074ee04de447633ed", "SLES12SP2SAPHVM": "ami-c9d0e1a6", "SLES12SP3HVM": "ami-0c1453eb750c7a5ab", "SLES12SP3SAPBYOSHVM": "ami-00831fe0c42624267", "SLES12SP3SAPHVM": "ami-07f4b7391f161620b", "SLES12SP4HVM": "ami-0e2520e97af25d4d2", "SLES12SP4SAPBYOSHVM": "ami-05651b45e99d63d02", "SLES12SP4SAPHVM": "ami-0e8077fc616b0fee0", "SLES15HVM": "ami-01be89269d32f2a16", "SLES15SAPHVM": "ami-03e5ec9da485cf78d", "SLES15SAPBYOSHVM": "ami-0d5612595295301aa", "WS2012R2": "ami-055b8cce72c3fe0fe"}, "ap-southeast-1": {"RHEL75SAPHVM": "ami-08fc0673d9d83037a", "RHEL74SAPHAUSHVM": "ami-037dc0ec600ed1888", "RHEL75SAPHAUSHVM": "ami-05c8713dd14fa6156", "RHEL76SAPHAUSHVM": "ami-0469d4463a41ed704", "SLES11SP4HVM": "ami-021e49892145e1949", "SLES12SP1HVM": "ami-163d9b75", "SLES12SP1SAPBYOSHVM": "ami-ab0aa0c8", "SLES12SP2HVM": "ami-f1078a92", "SLES12SP2SAPBYOSHVM": "ami-0c5d434c11072f709", "SLES12SP2SAPHVM": "ami-d558203f", "SLES12SP3HVM": "ami-06190570cf455031a", "SLES12SP3SAPBYOSHVM": "ami-0a91084c1447100ed", "SLES12SP3SAPHVM": "ami-06fbabde04a3b021c", "SLES12SP4HVM": "ami-05a7bd74a593452d7", "SLES12SP4SAPBYOSHVM": "ami-07bae09461b7a3942", "SLES12SP4SAPHVM": "ami-0e620bb60d89688e5", "SLES15HVM": "ami-070356c21596ddc67", "SLES15SAPHVM": "ami-049eedea82bef56f8", "SLES15SAPBYOSHVM": "ami-0701f0c9a5e645fe6", "WS2012R2": "ami-01247b8894d425ad8"}, "ap-southeast-2": {"RHEL75SAPHVM": "ami-0a8af8e94f35319ba", "RHEL74SAPHAUSHVM": "ami-0c5b5357081c68218", "RHEL75SAPHAUSHVM": "ami-0df9dbd4828ca1166", "RHEL76SAPHAUSHVM": "ami-0356eb53cb824dc7e", "SLES11SP4HVM": "ami-0c966540b7cd84b4b", "SLES12SP1HVM": "ami-e32b1680", "SLES12SP1SAPBYOSHVM": "ami-460d0a25", "SLES12SP2HVM": "ami-197a6a7a", "SLES12SP2SAPBYOSHVM": "ami-0e9b31a7f29df983d", "SLES12SP2SAPHVM": "ami-ad41e4cf", "SLES12SP3HVM": "ami-0ccbc8eb74e84b8bd", "SLES12SP3SAPBYOSHVM": "ami-0a22e7733b93a13cd", "SLES12SP3SAPHVM": "ami-081fa0b36595ffa8e", "SLES12SP4HVM": "ami-0086939d81dda5418", "SLES12SP4SAPBYOSHVM": "ami-0de01b6abc06547bb", "SLES12SP4SAPHVM": "ami-04df7149eb95ce35c", "SLES15HVM": "ami-0c4245381c67efb39", "SLES15SAPHVM": "ami-0c8e08a4eca309634", "SLES15SAPBYOSHVM": "ami-0f5b781af42cbfa1e", "WS2012R2": "ami-05ae58c04d30b1579"}, "ca-central-1": {"RHEL75SAPHVM": "ami-010ef109ec0f43d6d", "RHEL74SAPHAUSHVM": "ami-06e94c1c4cd754fe5", "RHEL75SAPHAUSHVM": "ami-0173442cbf82d3d9f", "RHEL76SAPHAUSHVM": "ami-0c720e8ded4a6c5b0", "SLES11SP4HVM": "ami-0a89186e8d2b82307", "SLES12SP1SAPBYOSHVM": "ami-2fd4694b", "SLES12SP2HVM": "ami-d5d56ab1", "SLES12SP2SAPBYOSHVM": "ami-06c5c26336f743bf6", "SLES12SP2SAPHVM": "ami-23ca4747", "SLES12SP3HVM": "ami-0f7c9a39e20a9adea", "SLES12SP3SAPBYOSHVM": "ami-0bfb8d54b1407c64a", "SLES12SP3SAPHVM": "ami-0988b135bab749ed1", "SLES12SP4HVM": "ami-00ff1fa0fb4b09437", "SLES12SP4SAPBYOSHVM": "ami-07735575a65d9748f", "SLES12SP4SAPHVM": "ami-0c6652e12b3950c7a", "SLES15HVM": "ami-0c97d9b588207dad6", "SLES15SAPHVM": "ami-3e28a55a", "SLES15SAPBYOSHVM": "ami-08eec3db50798a295", "WS2012R2": "ami-086541da748fd1b23"}, "eu-central-1": {"RHEL75SAPHVM": "ami-0841ec948df565271", "RHEL74SAPHAUSHVM": "ami-0a38565bcb3243da0", "RHEL75SAPHAUSHVM": "ami-08f1018e2a0f26daa", "RHEL76SAPHAUSHVM": "ami-00e9db6661b279d3f", "SLES11SP4HVM": "ami-0f032693ef4319469", "SLES12SP1HVM": "ami-59699036", "SLES12SP1SAPBYOSHVM": "ami-4b6ba424", "SLES12SP2HVM": "ami-984ee9f7", "SLES12SP2SAPBYOSHVM": "ami-07966002b34bab5f7", "SLES12SP2SAPHVM": "ami-2a6463c1", "SLES12SP3HVM": "ami-0fa9bde3f3d40e5ae", "SLES12SP3SAPBYOSHVM": "ami-088e91696b7dcd30c", "SLES12SP3SAPHVM": "ami-01cdd8aeedf0bb409", "SLES12SP4HVM": "ami-00f695136e33f2fe0", "SLES12SP4SAPBYOSHVM": "ami-0e6f5d8c7423fbf99", "SLES12SP4SAPHVM": "ami-00ec48d008cf042fc", "SLES15HVM": "ami-05dfd265ea534a3e9", "SLES15SAPHVM": "ami-0dc8825f67b48b3cb", "SLES15SAPBYOSHVM": "ami-0c3196786bb2ef35a", "WS2012R2": "ami-08dcceb529e70f875"}, "eu-west-1": {"RHEL75SAPHVM": "ami-04a014a7d626b3fd8", "RHEL74SAPHAUSHVM": "ami-0af3e97778546f34b", "RHEL75SAPHAUSHVM": "ami-0dfa47f27b3bf9922", "RHEL76SAPHAUSHVM": "ami-0e39a11a4694e879d", "SLES11SP4HVM": "ami-0a40ff0e3202c10e1", "SLES12SP1HVM": "ami-b197d9c2", "SLES12SP1SAPBYOSHVM": "ami-81025de7", "SLES12SP2HVM": "ami-f5776f93", "SLES12SP2SAPBYOSHVM": "ami-083a4aebd9d24276c", "SLES12SP2SAPHVM": "ami-fa0c1e10", "SLES12SP3HVM": "ami-06bc7889ee68f279e", "SLES12SP3SAPBYOSHVM": "ami-0461814360323e368", "SLES12SP3SAPHVM": "ami-06ef609642514a5dc", "SLES12SP4HVM": "ami-0b27edba737a4a44a", "SLES12SP4SAPBYOSHVM": "ami-0a850f691a934ad5e", "SLES12SP4SAPHVM": "ami-0c78bd881f6e70c39", "SLES15HVM": "ami-0a58a1b152ba55f1d", "SLES15SAPHVM": "ami-0533a134eaeabea0f", "SLES15SAPBYOSHVM": "ami-032a80d78e21d81a3", "WS2012R2": "ami-023aa6510439dee1d"}, "eu-west-2": {"RHEL75SAPHVM": "ami-070b8ef548695f653", "RHEL74SAPHAUSHVM": "ami-005b4b0f0decc3229", "RHEL75SAPHAUSHVM": "ami-0d24c16fec55a94f4", "RHEL76SAPHAUSHVM": "ami-0aeabd574eb91aa0b", "SLES11SP4HVM": "ami-06a87787f9466fa7b", "SLES12SP1SAPBYOSHVM": "ami-b2a1abd6", "SLES12SP2HVM": "ami-d97066bd", "SLES12SP2SAPBYOSHVM": "ami-0e77c12686f306f46", "SLES12SP2SAPHVM": "ami-2992794e", "SLES12SP3HVM": "ami-0eb4bd78fba2f32e4", "SLES12SP3SAPBYOSHVM": "ami-04e2fe477c0a1411f", "SLES12SP3SAPHVM": "ami-00549ed02ae342143", "SLES12SP4HVM": "ami-01016d5a2f759e80e", "SLES12SP4SAPBYOSHVM": "ami-0ac859e29f5094204", "SLES12SP4SAPHVM": "ami-0b223a6f9dee7908f", "SLES15HVM": "ami-01497522185aaa4ee", "SLES15SAPHVM": "ami-2cce3b4b", "SLES15SAPBYOSHVM": "ami-06f2df89214f6ead9", "WS2012R2": "ami-0722861d8f432ad84"}, "eu-west-3": {"RHEL75SAPHVM": "ami-0b9d6c1ae0e94e8a9", "RHEL74SAPHAUSHVM": "ami-01f114d111cc45831", "RHEL75SAPHAUSHVM": "ami-0d0e00736cd23369b", "RHEL76SAPHAUSHVM": "ami-0c1cf4ecf66e353e8", "SLES11SP4HVM": "ami-036671c4b09355867", "SLES12SP1SAPBYOSHVM": "ami-cf992eb2", "SLES12SP2SAPBYOSHVM": "ami-0664ede0d13c0c473", "SLES12SP2SAPHVM": "ami-bfbf0fc2", "SLES12SP3HVM": "ami-07b20332d54ed21e8", "SLES12SP3SAPBYOSHVM": "ami-033b4942a6ba88005", "SLES12SP3SAPHVM": "ami-0ad053b84386d8e9e", "SLES12SP4HVM": "ami-077db4bb21fe102b3", "SLES12SP4SAPBYOSHVM": "ami-0c63b2bb6afc549b4", "SLES12SP4SAPHVM": "ami-0d4234cfe8875463e", "SLES15HVM": "ami-0f238bd4c6fdbefb0", "SLES15SAPHVM": "ami-0c754746fa7bb159f", "SLES15SAPBYOSHVM": "ami-0f842e919e4e4eb6a", "WS2012R2": "ami-0eef709506f197216"}, "sa-east-1": {"RHEL75SAPHVM": "ami-0a9ee704defec0845", "RHEL74SAPHAUSHVM": "ami-04450cf66c6bf5f42", "RHEL75SAPHAUSHVM": "ami-0fb635cae4f8c6028", "RHEL76SAPHAUSHVM": "ami-0c60751a062c4295b", "SLES11SP4HVM": "ami-00134f83806a20f4a", "SLES12SP1HVM": "ami-ce3aa7a2", "SLES12SP1SAPBYOSHVM": "ami-eb543187", "SLES12SP2HVM": "ami-52a4cf3e", "SLES12SP2SAPBYOSHVM": "ami-046181f67382fdd53", "SLES12SP2SAPHVM": "ami-5cd5f230", "SLES12SP3HVM": "ami-0188b2a9dc0ae5f44", "SLES12SP3SAPBYOSHVM": "ami-0ec3fee2bd8133f91", "SLES12SP3SAPHVM": "ami-09e61be8a308aefa1", "SLES12SP4HVM": "ami-022eaa5bbc1e2f47a", "SLES12SP4SAPBYOSHVM": "ami-0451db96691925d3b", "SLES12SP4SAPHVM": "ami-09397f09bcef3938f", "SLES15HVM": "ami-0772af912976aa692", "SLES15SAPHVM": "ami-006759726120a9731", "SLES15SAPBYOSHVM": "ami-0a374c04d3223b56d", "WS2012R2": "ami-03af99f7954cc9501"}, "us-east-1": {"RHEL75SAPHVM": "ami-05cd8f1730c8df7dc", "RHEL74SAPHAUSHVM": "ami-0f458a41a777ef497", "RHEL75SAPHAUSHVM": "ami-0d81d8964ccf8bdef", "RHEL76SAPHAUSHVM": "ami-054a9dc6c144331a0", "SLES11SP4HVM": "ami-05b47745292b62b8e", "SLES12SP1HVM": "ami-1eeab909", "SLES12SP1SAPBYOSHVM": "ami-7dd2256b", "SLES12SP2HVM": "ami-8fac8399", "SLES12SP2SAPBYOSHVM": "ami-006668674e5150470", "SLES12SP2SAPHVM": "ami-1c477763", "SLES12SP3HVM": "ami-03adb8813ffd80f0b", "SLES12SP3SAPBYOSHVM": "ami-09e515a2f58fc7a93", "SLES12SP3SAPHVM": "ami-004b5b84ba4775620", "SLES12SP4HVM": "ami-0787571b4033204ad", "SLES12SP4SAPBYOSHVM": "ami-0f9b20b9789585aa4", "SLES12SP4SAPHVM": "ami-028879abe89eccb1f", "SLES15HVM": "ami-0b1764f3d7d2e2316", "SLES15SAPHVM": "ami-0515c038316a21ce6", "SLES15SAPBYOSHVM": "ami-0b335002243e5a9ff", "WS2012R2": "ami-055c10ae78f3a58a2"}, "us-east-2": {"RHEL75SAPHVM": "ami-0b1439383ea0d0c87", "RHEL74SAPHAUSHVM": "ami-0cfab53d572d62388", "RHEL75SAPHAUSHVM": "ami-03527d73c82921684", "RHEL76SAPHAUSHVM": "ami-02bf9176554430b2a", "SLES11SP4HVM": "ami-0d984fc673fefcb8c", "SLES12SP1HVM": "ami-85075de0", "SLES12SP1SAPBYOSHVM": "ami-ac2401c9", "SLES12SP2HVM": "ami-f990b69c", "SLES12SP2SAPBYOSHVM": "ami-0312e837f2f3e7ed3", "SLES12SP2SAPHVM": "ami-e10c3784", "SLES12SP3HVM": "ami-0479b39f2d07530fb", "SLES12SP3SAPBYOSHVM": "ami-03dcbd3a0a73c3e1c", "SLES12SP3SAPHVM": "ami-081afa1d3de3a3469", "SLES12SP4HVM": "ami-0f24364ccc4040c21", "SLES12SP4SAPBYOSHVM": "ami-0b4e01a990b03a9ae", "SLES12SP4SAPHVM": "ami-0b0e4f0c8dee3ba25", "SLES15HVM": "ami-05ea824317ffc0c20", "SLES15SAPHVM": "ami-072faa863248b2f76", "SLES15SAPBYOSHVM": "ami-00ee7014fa39c34cd", "WS2012R2": "ami-03aa4445f535b27bc"}, "us-west-1": {"RHEL75SAPHVM": "ami-015c680b92b8f8e04", "RHEL74SAPHAUSHVM": "ami-0bce690da8c3f9573", "RHEL75SAPHAUSHVM": "ami-09294cb9917bcb535", "RHEL76SAPHAUSHVM": "ami-05163897ae5e64145", "SLES11SP4HVM": "ami-07db9616cb48eef6e", "SLES12SP1HVM": "ami-a12962c1", "SLES12SP1SAPBYOSHVM": "ami-4a9dcf2a", "SLES12SP2HVM": "ami-32c8e552", "SLES12SP2SAPBYOSHVM": "ami-039ae8bf416dc3bde", "SLES12SP2SAPHVM": "ami-5f64873c", "SLES12SP3HVM": "ami-05561250b8346a707", "SLES12SP3SAPBYOSHVM": "ami-0f7b3754a9689ddfa", "SLES12SP3SAPHVM": "ami-081e62a74b0decab1", "SLES12SP4HVM": "ami-0afb3187a37661b18", "SLES12SP4SAPBYOSHVM": "ami-04e84846cf5b2eceb", "SLES12SP4SAPHVM": "ami-0aaf2ced31cb3e61d", "SLES15HVM": "ami-00e34a7624e5a7107", "SLES15SAPHVM": "ami-0ba91cdd03fe27cbf", "SLES15SAPBYOSHVM": "ami-039fb1d14e2287565", "WS2012R2": "ami-02ad1ae3d4204b530"}, "us-west-2": {"RHEL75SAPHVM": "ami-07894ab0a4a5e8612", "RHEL74SAPHAUSHVM": "ami-050890ecc1851620c", "RHEL75SAPHAUSHVM": "ami-07f49a6a84d94211e", "RHEL76SAPHAUSHVM": "ami-0062814abe5ca3369", "SLES11SP4HVM": "ami-09a652af9ed1e0dad", "SLES12SP1HVM": "ami-7fa2061f", "SLES12SP1SAPBYOSHVM": "ami-68922c08", "SLES12SP2HVM": "ami-da786da3", "SLES12SP2SAPBYOSHVM": "ami-057a6cd34fc874a04", "SLES12SP2SAPHVM": "ami-7bb5e603", "SLES12SP3HVM": "ami-015ee9a0398544b09", "SLES12SP3SAPBYOSHVM": "ami-02df08fd0856d266b", "SLES12SP3SAPHVM": "ami-0e92a9cb236c63db2", "SLES12SP4HVM": "ami-0a3c873f21d686544", "SLES12SP4SAPBYOSHVM": "ami-042663489704d9c3f", "SLES12SP4SAPHVM": "ami-0b29b72ab7217f395", "SLES15HVM": "ami-0f1e3b3fb0fec0361", "SLES15SAPHVM": "ami-8b7350f3", "SLES15SAPBYOSHVM": "ami-08c05da8c43e5091a", "WS2012R2": "ami-0d639a48468c98db8"}}}, "Outputs": {"SAPPASSecurityGroup": {"Description": "Security Group created for the SAP PAS Server", "Value": {"Fn::GetAtt": ["SAPAASSecurityGroup", "GroupId"]}}}, "Resources": {"AutoRecoverAlarmMaster": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryMaster", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 2 consecutive minutes  .", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "2", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "SAPAASInstance"}}]}}, "SAPAASR53Record": {"Type": "AWS::Route53::RecordSet", "Properties": {"HostedZoneId": {"Ref": "HostedZoneID"}, "Name": {"Fn::Sub": "${SAPAASHostname}.${HostedZoneName}"}, "Type": "A", "TTL": "30", "ResourceRecords": [{"Fn::GetAtt": ["SAPAASInstance", "PrivateIp"]}]}}, "SAPAASSecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable access to the SAP Servers", "VpcId": {"Ref": "VPCID"}, "SecurityGroupIngress": [{"IpProtocol": "udp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": "111", "ToPort": "111"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": "2049", "ToPort": "2049"}, {"IpProtocol": "icmp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": "-1", "ToPort": "-1"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": {"Fn::Join": ["", ["32", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["33", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": {"Fn::Join": ["", ["36", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["36", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": "1128", "ToPort": "1128"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet1CIDR"}, "FromPort": "1129", "ToPort": "1129"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "111", "ToPort": "111"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "2049", "ToPort": "2049"}, {"IpProtocol": "icmp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "-1", "ToPort": "-1"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": {"Fn::Join": ["", ["32", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["33", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": {"Fn::Join": ["", ["36", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["36", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "1128", "ToPort": "1128"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "1129", "ToPort": "1129"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "22", "ToPort": "22"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivateSubnet2CIDR"}, "FromPort": "22", "ToPort": "22"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PublicSubnet1CIDR"}, "FromPort": "22", "ToPort": "22"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PublicSubnet2CIDR"}, "FromPort": "22", "ToPort": "22"}], "SecurityGroupEgress": [{"IpProtocol": "-1", "CidrIp": "0.0.0.0/0", "FromPort": "1", "ToPort": "65535"}]}}, "SAPAASIAMRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Statement": [{"Effect": "Allow", "Principal": {"Service": ["ec2.amazonaws.com", "ssm.amazonaws.com"]}, "Action": ["sts:AssumeRole"]}]}, "Path": "/", "ManagedPolicyArns": ["arn:aws:iam::aws:policy/service-role/AmazonEC2RoleforSSM"], "Policies": [{"PolicyName": "SAP-AAS-Autoscaling", "PolicyDocument": {"Statement": [{"Effect": "Allow", "Action": "cloudwatch:GetMetricStatistics", "Resource": "*"}, {"Effect": "Allow", "Action": ["s3:GetObject"], "Resource": [{"Fn::Sub": "arn:aws:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*"}, {"Fn::Sub": "arn:aws:s3:::aws-data-provider/*"}]}, {"Effect": "Allow", "Action": ["ec2:DescribeInstances", "ec2:DescribeVolumes"], "Resource": "*"}, {"Effect": "Allow", "Action": ["ec2messages:*"], "Resource": "*"}, {"Effect": "Allow", "Action": "ssm:*", "Resource": {"Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/${SAPNetWeaverPassSSMParamName}"}}, {"Effect": "Allow", "Action": "ssm:ListCommandInvocations", "Resource": {"Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:*"}}, {"Effect": "Allow", "Action": "ssm:*", "Resource": [{"Fn::Sub": "arn:aws:ec2:${AWS::Region}:${AWS::AccountId}:instance/*"}, {"Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:instance/*"}, {"Fn::Sub": "arn:aws:ssm:${AWS::Region}::document/AWS-RunShellScript"}]}]}}]}}, "SAPAASInterface": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"Description": "Network Interface for SAP AAS server", "SubnetId": {"Ref": "PrivateSubnetID"}, "GroupSet": [{"Ref": "SAPAASSecurityGroup"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "SAPIAMProfile": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Path": "/", "Roles": [{"Ref": "SAPAASIAMRole"}]}}, "WaitForSAPInstall": {"Type": "AWS::CloudFormation::WaitCondition", "Properties": {"Handle": {"Ref": "WaitForSAPInstallWaitHandle"}, "Timeout": "14400"}}, "WaitForSAPInstallWaitHandle": {"Type": "AWS::CloudFormation::WaitConditionHandle", "Properties": {}}, "SAPAASInstance": {"Type": "AWS::EC2::Instance", "Metadata": {"AWS::CloudFormation::Authentication": {"S3AccessCreds": {"type": "S3", "roleName": {"Ref": "SAPAASIAMRole"}, "buckets": [{"Ref": "QSS3BucketName"}]}}, "AWS::CloudFormation::Init": {"config": {"files": {"/root/install/config.sh": {"content": {"Fn::Join": ["", ["export ASCS_NAME=", {"Ref": "SAPASCSHostname"}, "\n", "export DistributedInstall=", {"Ref": "DistributedInstall"}, "\n", "export EFS=", {"Ref": "EFSSapmnt"}, "\n", "export EFS_MT=", {"Ref": "EFSFSName"}, "\n", "export HOSTED_ZONE=", {"Ref": "HostedZoneName"}, "\n", "export INSTALL_SAP=", {"Ref": "InstallSAP"}, "\n", "export INSTALL_SAP_VERSION=", {"Ref": "InstallSAPVersion"}, "\n", "export SAP_SCHEMA_NAME=", {"Ref": "SAPSchemaName"}, "\n", "export SAP_SID=", {"Ref": "SID"}, "\n", "export SSM_PARAM_STORE=", {"Ref": "SAPNetWeaverPassSSMParamName"}, "\n", "export TZ_INPUT_PARAM=", {"Ref": "SAPTZ"}, "\n", "export DBHOSTNAME=", {"Ref": "SAPHANAHostname"}, "\n", "export INSTALL_SAP=", {"Ref": "InstallSAP"}, "\n", "export MyOS=", {"Ref": "MyOS"}, "\n", "export SLESBYOSRegCode=", {"Ref": "SLESBYOSRegCode"}, "\n", "export HOSTNAME=", {"Ref": "SAPAASHostname"}, "\n", "export SAPInstanceNum=", {"Ref": "SAPInstanceNum"}, "\n", "export SAP_PAS=", {"Ref": "SAPPASHostname"}, "\n", "export WaitForSAPInstallWaitHandle=", "\"", {"Ref": "WaitForSAPInstallWaitHandle"}, "\"", "\n", "export SIDadmUID=", {"Ref": "SIDadmUID"}, "\n", "export REGION=", {"Ref": "AWS::Region"}, "\n"]]}, "mode": "000400", "owner": "root", "group": "root"}, "/root/install/s4-aas.params": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-aas.params"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/s4-ascs.params": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-ascs.params"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/s4-db.params": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-db.params"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/s4-pas.params": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-pas.params"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/signalFinalStatus.sh": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/signalFinalStatus.sh"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/sap-s4hana-aas-inst-dnl.sh": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/sap-s4hana-aas-inst-dnl.sh"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}, "/root/install/sap-s4hana-aas-inst.sh": {"source": {"Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/sap-s4hana-aas-inst.sh"}, "mode": "000500", "owner": "root", "group": "root", "authentication": "S3AccessCreds"}}, "commands": {"startinstall": {"command": "bash -xv /root/install/sap-s4hana-aas-inst-dnl.sh"}}}}}, "Properties": {"BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"DeleteOnTermination": "True", "VolumeSize": "50", "VolumeType": "gp2"}}, {"DeviceName": "/dev/xvdb", "Ebs": {"DeleteOnTermination": "True", "VolumeSize": "50", "VolumeType": "gp2"}}, {"DeviceName": "/dev/xvdc", "Ebs": {"DeleteOnTermination": "True", "VolumeSize": "50", "VolumeType": "gp2"}}], "InstanceType": {"Ref": "MyInstanceType"}, "KeyName": {"Ref": "KeyName"}, "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "SAPIAMProfile"}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "SAPAASInterface"}, "DeviceIndex": "0"}], "Tags": [{"Key": "Name", "Value": {"Ref": "SAPAASHostname"}}]}}}, "Rules": {"EFSSupport": {"RuleCondition": {"Fn::Equals": [{"Ref": "EFSSapmnt"}, "Yes"]}, "Assertions": [{"Assert": {"Fn::Contains": [["us-east-1", "us-east-2", "us-west-1", "us-west-2", "eu-central-1", "eu-west-1", "eu-west-2", "eu-west-3", "eu-central-1", "ca-central-1", "ap-south-1", "ap-northeast-1", "ap-northeast-2", "ap-southeast-1", "ap-southeast-2"], {"Ref": "AWS::Region"}]}, "AssertDescription": "!!ALERT: This is *not* an AWS Region that supports EFS!!"}]}}}
