{"AWSTemplateFormatVersion": "2010-09-09", "Description": "(0008) Deploy SAP HANA on AWS", "Parameters": {"VPCID": {"Description": "The existing Amazon VPC where you want to deploy SAP HANA.", "Type": "AWS::EC2::VPC::Id"}, "PrivSubCIDR": {"Description": "CIDR block of the private subnet where SAP HANA will be deployed.", "Type": "String", "Default": "10.0.1.0/24", "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"}, "DMZCIDR": {"Description": "CIDR block of the public DMZ subnet where BASTION Host / NAT Gateway exist.", "Type": "String", "Default": "10.0.2.0/24", "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"}, "RemoteAccessCIDR": {"Description": "CIDR block from where you want to access your RDP instance.", "Type": "String", "Default": "0.0.0.0/0", "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$", "ConstraintDescription": "This must be a valid CIDR range in the format x.x.x.x/x."}, "HANASubnet": {"Type": "AWS::EC2::Subnet::Id", "Description": "The existing private subnet in your VPC where you want to deploy SAP HANA."}, "ApplicationCIDR": {"Description": "CIDR block of subnet where SAP Application servers are deployed.", "Type": "String", "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$", "Default": "0.0.0.0/0", "ConstraintDescription": "This must be a valid CIDR range in the format x.x.x.x/x."}, "DMZSubnet": {"Type": "AWS::EC2::Subnet::Id", "Description": "The existing public subnet in your VPC where you want to deploy the optional RDP instance."}, "DomainName": {"Type": "String", "Description": "Name to use for fully qualified domain names.", "Default": "local"}, "HANAMasterHostname": {"Type": "String", "Description": "Host name to use for SAP HANA master node (DNS short name).", "Default": "imdbmaster"}, "HANAWorkerHostname": {"Type": "String", "Description": "Host name to use for SAP HANA worker node(s) (DNS short name).", "Default": "imdbworker"}, "PlacementGroupName": {"Type": "String", "Default": "", "Description": "Name of an existing placement group where SAP HANA should be deployed (for scale-out deployments."}, "PrivateBucket": {"Description": "Main build bucket where templates and scripts are located.", "Type": "String", "Default": "aws-quickstart/quickstart-sap-hana"}, "CustomStorageConfig": {"Description": "S3 location where custom storage configuration file is localted.", "Type": "String", "Default": "aws-quickstart/quickstart-sap-hana/scripts"}, "Proxy": {"Description": "Proxy address for http access (e.g., http://xyz.abc.com:8080 or http://10.x.x.x:8080).", "Type": "String", "Default": ""}, "KeyName": {"Type": "AWS::EC2::KeyPair::KeyName", "Default": "home", "Description": "Name of an existing Amazon EC2 key pair. All instances will launch with this key pair."}, "HANAInstallMedia": {"Description": "Full path to Amazon S3 location of SAP HANA software files (e.g., s3://myhanabucket/sap-hana-sps11/).", "Type": "String", "Default": ""}, "EnableLogging": {"Description": "Enable (Yes) or disable (No) logging with AWS CloudTrail and AWS Config.", "Default": "No", "Type": "String", "AllowedValues": ["Yes", "No"]}, "CloudTrailS3Bucket": {"Description": "Name of S3 bucket where AWS CloudTrail trails and AWS Config log files can be stored (e.g., mycloudtrail).", "Default": "", "Type": "String"}, "AutoRecovery": {"Type": "String", "Description": "Enable (Yes) or disable (No) automatic recovery feature for SAP HANA nodes. Disable it for Dedicated Host Deployments", "Default": "Yes", "AllowedValues": ["Yes", "No"]}, "AWSEFS": {"Type": "String", "Description": "Use (Yes) or don't use (No) Amazon EFS for HANA shared file system.", "Default": "Yes", "AllowedValues": ["Yes", "No"]}, "Encryption": {"Type": "String", "Description": "Enable (Yes) or disable (No) encryption on EBS volumes.", "Default": "No", "AllowedValues": ["Yes", "No"]}, "VolumeTypeHanaData": {"Type": "String", "Description": "EBS volume type for SAP HANA Data: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).", "Default": "gp2", "AllowedValues": ["gp2", "io1"]}, "VolumeTypeHanaLog": {"Type": "String", "Description": "EBS volume type for SAP HANA Log: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).", "Default": "gp2", "AllowedValues": ["gp2", "io1"]}, "MyOS": {"Type": "String", "Description": "Operating system (SLES or RHEL) and version for master and worker nodes.", "Default": "SuSELinux12SP4ForSAP", "AllowedValues": ["RedHatLinux75ForSAP", "RedHatLinux74ForSAP-With-HA-US", "RedHatLinux75ForSAP-With-HA-US", "RedHatLinux76ForSAP-With-HA-US", "SuSELinux11SP4", "SuSELinux12SP1", "SuSELinux12SP3", "SuSELinux12SP4", "SuSELinux15", "SuSELinux12SP2ForSAP", "SuSELinux12SP3ForSAP", "SuSELinux12SP4ForSAP", "SuSELinux15ForSAP", "SuSELinux12SP1ForSAP-BYOS", "SuSELinux12SP2ForSAP-BYOS", "SuSELinux12SP3ForSAP-BYOS", "SuSELinux12SP4ForSAP-BYOS", "SuSELinux15ForSAP-BYOS"]}, "SLESBYOSRegCode": {"Type": "String", "Default": "", "Description": "Registration code for SUSE BYOS (Applicable only if you use BYOS Option).", "NoEcho": "true"}, "InstallRDPInstance": {"Type": "String", "Description": "Install (Yes) or don't install (No) optional Windows RDP instance.", "Default": "No", "AllowedValues": ["Yes", "No"]}, "InstallHANA": {"Type": "String", "Description": "Install (Yes) or don't install (No) HANA. When set to No, only AWS infrastructure is provisioned.", "Default": "Yes", "AllowedValues": ["Yes", "No"]}, "RDPInstanceType": {"Type": "String", "Description": "Instance type for Windows RDP instance.", "Default": "c5.large", "AllowedValues": ["c4.large", "c4.xlarge", "c5.large", "c5.xlarge", "m4.large", "m4.xlarge", "m5.large", "m5.xlarge"]}, "MyInstanceType": {"Type": "String", "Description": "Instance type for SAP HANA host.", "Default": "r5.2xlarge", "AllowedValues": ["r3.8xlarge", "r3.4xlarge", "r3.2xlarge", "r4.16xlarge", "r4.8xlarge", "r4.4xlarge", "r4.2xlarge", "r5.2xlarge", "r5.4xlarge", "r5.12xlarge", "r5.24xlarge", "r5.metal", "x1.16xlarge", "x1.32xlarge", "x1e.xlarge", "x1e.2xlarge", "x1e.4xlarge", "x1e.32xlarge", "u-6tb1.metal", "u-9tb1.metal", "u-12tb1.metal", "u-18tb1.metal", "u-24tb1.metal"]}, "DedicatedHostId": {"Type": "CommaDelimitedList", "Description": "Existing dedicated host(s) where you want to launch your EC2 instance(s). Use comma to provide multiple hosts. Mandatory for Amazon EC2 High Memory Instances.", "Default": ""}, "HostCount": {"Type": "Number", "Description": "Total number of SAP HANA nodes you want to deploy in the SAP HANA cluster.", "Default": "1", "MinValue": "1", "MaxValue": "5"}, "SID": {"Type": "String", "Default": "HDB", "Description": "SAP HANA system ID for installation and setup.", "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})", "ConstraintDescription": "This value must consist of 3 characters."}, "SAPInstanceNum": {"Type": "String", "Default": "00", "Description": "SAP HANA instance number to use for installation and setup, and to open ports for security groups.", "AllowedPattern": "([0-8]{1}[0-9]{1}|[9]{1}[0-7]{1})", "ConstraintDescription": "Instance number must be between 00 and 97."}, "HANAMasterPass": {"Type": "String", "Description": "SAP HANA password to use during installation. Must be at least 8 characters with uppercase, lowercase, and numeric values.", "NoEcho": "true", "MinLength": "8", "AllowedPattern": "^(?=.*?[a-z])(?=.*?[A-Z])(?=.*[0-9]).*", "ConstraintDescription": "This must be at least 8 characters, including uppercase, lowercase, and numeric values."}, "SAPTZ": {"AllowedValues": ["CT", "ET", "JT", "PT", "UC"], "ConstraintDescription": "This value must consist of 2 characters.", "Default": "UC", "Description": "The TimeZone of your SAP HANA Server (PT, CT, ET, or UTC)", "Type": "String"}, "LatestWS2012AmiId": {"Type": "AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>", "Default": "/aws/service/ami-windows-latest/Windows_Server-2012-R2_RTM-English-64Bit-Base", "Description": "Do not change. Fetch latest Windows Server 2012 image id.", "AllowedValues": ["/aws/service/ami-windows-latest/Windows_Server-2012-R2_RTM-English-64Bit-Base"]}}, "Metadata": {"AWSAMIRegionMap": {"Filters": {"RHEL75SAPHVM": {"name": "SAP-7.5_HVM_GA-????????-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "RHEL74SAPHAUSHVM": {"name": "SAPHAE4S-7.4_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "RHEL75SAPHAUSHVM": {"name": "SAPHAEUS-7.5_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "RHEL76SAPHAUSHVM": {"name": "SAP-7.6_E4S_HA_US_HVM-????????-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "SLES12SP2SAPHVM": {"name": "*-e3458d64-5c36-4577-bd98-0ee19e3eaeec-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "SLES12SP3SAPHVM": {"name": "*-da7aa9c3-97db-4573-89a6-7fe7348d90b0-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "SLES12SP4SAPHVM": {"name": "*-8f7bb679-fb90-4446-aa80-9b6cfd834710-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}, "SLES15SAPHVM": {"name": "*-6a4bc5af-a084-4f96-8402-5cd249e9091d-*", "owner-alias": "aws-marketplace", "product-code.type": "marketplace"}}}, "AWS::CloudFormation::Interface": {"ParameterGroups": [{"Label": {"default": "Existing network infrastructure details"}, "Description": {"default": ""}, "Parameters": ["VPCID", "HANASubnet", "DMZSubnet", "PrivSubCIDR", "DMZCIDR"]}, {"Label": {"default": "Server and storage configuration"}, "Description": {"default": ""}, "Parameters": ["MyOS", "SLESBYOSRegCode", "MyInstanceType", "HostCount", "DedicatedHostId", "AutoRecovery", "KeyName", "VolumeTypeHanaData", "VolumeTypeHanaLog", "AWSEFS", "Encryption"]}, {"Label": {"default": "SAP HANA database configuration"}, "Description": {"default": ""}, "Parameters": ["DomainName", "HANAMasterHostname", "HANAWorkerHostname", "SID", "SAPInstanceNum", "HANAMasterPass", "SAPTZ", "HANAInstallMedia", "InstallHANA"]}, {"Label": {"default": "Optional configuration"}, "Description": {"default": ""}, "Parameters": ["PlacementGroupName", "InstallRDPInstance", "RDPInstanceType", "RemoteAccessCIDR", "ApplicationCIDR", "EnableLogging", "CloudTrailS3Bucket", "Proxy"]}, {"Label": {"default": "Advanced configuration (Do not modify unless directed by AWS Support)"}, "Description": {"default": ""}, "Parameters": ["PrivateBucket", "CustomStorageConfig", "LatestWS2012AmiId"]}], "ParameterLabels": {"VPCID": {"default": "Choose VPC ID"}, "PrivSubCIDR": {"default": "Enter CIDR block for private subnet"}, "DMZSubnet": {"default": "Choose public subnet"}, "DMZCIDR": {"default": "Enter CIDR block for public subnet"}, "HANASubnet": {"default": "Choose private subnet"}, "RemoteAccessCIDR": {"default": "Enter CIDR block for RDP access"}, "DomainName": {"default": "Enter domain name"}, "HANAMasterHostname": {"default": "Enter SAP HANA master host name"}, "HANAWorkerHostname": {"default": "Enter SAP HANA worker host name"}, "HANAInstallMedia": {"default": "Enter Amazon S3 URL for SAP HANA software"}, "CloudTrailS3Bucket": {"default": "Enter S3 bucket name to store AWS CloudTrail trails and AWS Config logs"}, "PlacementGroupName": {"default": "Enter optional placement group name"}, "DedicatedHostId": {"default": "Enter Dedicated Host ID"}, "PrivateBucket": {"default": "Enter private bucket"}, "CustomStorageConfig": {"default": "Enter custom storage configuration location"}, "Proxy": {"default": "Enter proxy server address"}, "KeyName": {"default": "Choose key pair"}, "AutoRecovery": {"default": "Would you like to turn on automatic recovery?"}, "InstallRDPInstance": {"default": "Do you need a Windows RDP instance?"}, "InstallHANA": {"default": "Install SAP HANA software?"}, "AWSEFS": {"default": "Would you like to use Amazon EFS?"}, "Encryption": {"default": "Would you like to turn on encryption?"}, "VolumeTypeHanaData": {"default": "Choose storage volume type for SAP HANA Data"}, "VolumeTypeHanaLog": {"default": "Choose storage volume type for SAP HANA Log"}, "MyOS": {"default": "Choose operating system for SAP HANA"}, "SLESBYOSRegCode": {"default": "Enter SUSE BYOS Registration Code"}, "MyInstanceType": {"default": "Choose instance type for SAP HANA"}, "HostCount": {"default": "Enter number of SAP HANA hosts"}, "SID": {"default": "Enter SAP HANA system ID"}, "SAPInstanceNum": {"default": "Enter SAP HANA instance number"}, "HANAMasterPass": {"default": "Enter SAP HANA password"}, "RDPInstanceType": {"default": "Choose instance type for RDP host"}, "EnableLogging": {"default": "Would you like to enable AWS CloudTrail trails and AWS Config?"}, "SAPTZ": {"default": "Enter SAP HANA Server timezone"}, "ApplicationCIDR": {"default": "Enter CIDR block of your SAP Application Servers"}, "LatestWS2012AmiId": {"default": "WS2012R2 AMI ID SSM Parameter"}}}}, "Conditions": {"TwoOrMoreNodes": {"Fn::Or": [{"Fn::Equals": ["2", {"Ref": "HostCount"}]}, {"Fn::Equals": ["3", {"Ref": "HostCount"}]}, {"Fn::Equals": ["4", {"Ref": "HostCount"}]}, {"Fn::Equals": ["5", {"Ref": "HostCount"}]}, {"Fn::Equals": ["6", {"Ref": "HostCount"}]}]}, "ThreeOrMoreNodes": {"Fn::Or": [{"Fn::Equals": ["3", {"Ref": "HostCount"}]}, {"Fn::Equals": ["4", {"Ref": "HostCount"}]}, {"Fn::Equals": ["5", {"Ref": "HostCount"}]}, {"Fn::Equals": ["6", {"Ref": "HostCount"}]}]}, "FourOrMoreNodes": {"Fn::Or": [{"Fn::Equals": ["4", {"Ref": "HostCount"}]}, {"Fn::Equals": ["5", {"Ref": "HostCount"}]}, {"Fn::Equals": ["6", {"Ref": "HostCount"}]}]}, "FiveOrMoreNodes": {"Fn::Or": [{"Fn::Equals": ["5", {"Ref": "HostCount"}]}, {"Fn::Equals": ["6", {"Ref": "HostCount"}]}]}, "SixOrMoreNodes": {"Fn::Or": [{"Fn::Equals": ["6", {"Ref": "HostCount"}]}, {"Fn::Equals": ["7", {"Ref": "HostCount"}]}]}, "AutoRecoveryWorker1": {"Fn::And": [{"Fn::Equals": ["Yes", {"Ref": "AutoRecovery"}]}, {"Condition": "TwoOrMoreNodes"}]}, "AutoRecoveryWorker2": {"Fn::And": [{"Fn::Equals": ["Yes", {"Ref": "AutoRecovery"}]}, {"Condition": "ThreeOrMoreNodes"}]}, "AutoRecoveryWorker3": {"Fn::And": [{"Fn::Equals": ["Yes", {"Ref": "AutoRecovery"}]}, {"Condition": "FourOrMoreNodes"}]}, "AutoRecoveryWorker4": {"Fn::And": [{"Fn::Equals": ["Yes", {"Ref": "AutoRecovery"}]}, {"Condition": "FiveOrMoreNodes"}]}, "AutoRecoveryWorker5": {"Fn::And": [{"Fn::Equals": ["Yes", {"Ref": "AutoRecovery"}]}, {"Condition": "SixOrMoreNodes"}]}, "AutoRecoveryMaster": {"Fn::Equals": [{"Ref": "AutoRecovery"}, "Yes"]}, "NeedWindowsInstance": {"Fn::Equals": [{"Ref": "InstallRDPInstance"}, "Yes"]}, "PlacementGroupNull": {"Fn::Equals": [{"Ref": "PlacementGroupName"}, ""]}, "UseEFS": {"Fn::Equals": [{"Ref": "AWSEFS"}, "Yes"]}, "NoUseEFS": {"Fn::Equals": [{"Ref": "AWSEFS"}, "No"]}, "UseEncryption": {"Fn::Equals": [{"Ref": "Encryption"}, "Yes"]}, "IfDedicatedHost": {"Fn::Not": [{"Fn::Equals": [{"Fn::Select": ["0", {"Ref": "DedicatedHostId"}]}, ""]}]}, "IfLogging": {"Fn::Equals": [{"Ref": "EnableLogging"}, "Yes"]}, "IfAppSubnet": {"Fn::Not": [{"Fn::Equals": [{"Ref": "ApplicationCIDR"}, "0.0.0.0/0"]}]}, "IfUseSLES": {"Fn::Equals": [{"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}, "SLES"]}}, "Mappings": {"SAPAMINameMap": {"RedHatLinux75ForSAP": {"Code": "RHEL75SAPHVM"}, "RedHatLinux74ForSAP-With-HA-US": {"Code": "RHEL74SAPHAUSHVM"}, "RedHatLinux75ForSAP-With-HA-US": {"Code": "RHEL75SAPHAUSHVM"}, "RedHatLinux76ForSAP-With-HA-US": {"Code": "RHEL76SAPHAUSHVM"}, "SuSELinux11SP4": {"Code": "SLES11SP4HVM"}, "SuSELinux12SP1": {"Code": "SLES12SP1HVM"}, "SuSELinux12SP2": {"Code": "SLES12SP2HVM"}, "SuSELinux12SP3": {"Code": "SLES12SP3HVM"}, "SuSELinux12SP4": {"Code": "SLES12SP4HVM"}, "SuSELinux15": {"Code": "SLES15HVM"}, "SuSELinux12SP2ForSAP": {"Code": "SLES12SP2SAPHVM"}, "SuSELinux12SP3ForSAP": {"Code": "SLES12SP3SAPHVM"}, "SuSELinux12SP4ForSAP": {"Code": "SLES12SP4SAPHVM"}, "SuSELinux15ForSAP": {"Code": "SLES15SAPHVM"}, "SuSELinux12SP1ForSAP-BYOS": {"Code": "SLES12SP1SAPBYOSHVM"}, "SuSELinux12SP2ForSAP-BYOS": {"Code": "SLES12SP2SAPBYOSHVM"}, "SuSELinux12SP3ForSAP-BYOS": {"Code": "SLES12SP3SAPBYOSHVM"}, "SuSELinux12SP4ForSAP-BYOS": {"Code": "SLES12SP4SAPBYOSHVM"}, "SuSELinux15ForSAP-BYOS": {"Code": "SLES15SAPBYOSHVM"}}, "AWSAMIRegionMap": {"AMI": {"RHEL75SAPHVM": "SAP-7.5_HVM_GA-20180911-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-ami-01e5a531ae8d3d976.4", "RHEL74SAPHAUSHVM": "SAPHAE4S-7.4_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0c3e857ffeab71ac5.4", "RHEL75SAPHAUSHVM": "SAPHAEUS-7.5_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-081c0b27c08752050.4", "RHEL76SAPHAUSHVM": "SAP-7.6_E4S_HA_US_HVM-20190221-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0e49c67162a6956e9.4", "SLES11SP4HVM": "suse-sles-11-sp4-v20180816-hvm-ssd-x86_64", "SLES12SP1HVM": "suse-sles-12-sp1-v20161021-hvm-ssd-x86_64", "SLES12SP2HVM": "suse-sles-12-sp2-v20170620-hvm-ssd-x86_64", "SLES12SP3HVM": "suse-sles-12-sp3-v20181004-hvm-ssd-x86_64", "SLES12SP4HVM": "suse-sles-12-sp4-v20190314-hvm-ssd-x86_64", "SLES15HVM": "suse-sles-15-v20180806-hvm-ssd-x86_64", "SLES12SP2SAPHVM": "suse-sles-sap-12-sp2-v20180706-hvm-ssd-x86_64-e3458d64-5c36-4577-bd98-0ee19e3eaeec-ami-3ac5ea45.4", "SLES12SP3SAPHVM": "suse-sles-sap-12-sp3-v20180814-hvm-ssd-x86_64-da7aa9c3-97db-4573-89a6-7fe7348d90b0-ami-0df5b06332b816a8e.4", "SLES12SP4SAPHVM": "suse-sles-sap-12-sp4-v20181212-hvm-ssd-x86_64-8f7bb679-fb90-4446-aa80-9b6cfd834710-ami-015bf44384c484ccb.4", "SLES15SAPHVM": "suse-sles-sap-15-v20180806-hvm-ssd-x86_64-6a4bc5af-a084-4f96-8402-5cd249e9091d-ami-06aee2e6db735d4f4.4", "SLES12SP1SAPBYOSHVM": "suse-sles-sap-12-sp1-byos-v20170123-hvm-ssd-x86_64", "SLES12SP2SAPBYOSHVM": "suse-sles-sap-12-sp2-byos-v20180816-hvm-ssd-x86_64", "SLES12SP3SAPBYOSHVM": "suse-sles-sap-12-sp3-byos-v20180814-hvm-ssd-x86_64", "SLES12SP4SAPBYOSHVM": "suse-sles-sap-12-sp4-byos-v20190314-hvm-ssd-x86_64", "SLES15SAPBYOSHVM": "suse-sles-sap-15-byos-v20180816-hvm-ssd-x86_64"}, "ap-northeast-1": {"RHEL75SAPHVM": "ami-0ce47f39a0a21f61e", "RHEL74SAPHAUSHVM": "ami-0033f0d7d626f014f", "RHEL75SAPHAUSHVM": "ami-08d13c2bb0c07e8e3", "RHEL76SAPHAUSHVM": "ami-092eb64b443171d7e", "SLES11SP4HVM": "ami-0c6f393bb8d20159a", "SLES12SP1HVM": "ami-d94fe9b8", "SLES12SP1SAPBYOSHVM": "ami-63473c04", "SLES12SP2HVM": "ami-a07560c7", "SLES12SP2SAPBYOSHVM": "ami-0cd358eaaf4cfca8f", "SLES12SP2SAPHVM": "ami-322e43df", "SLES12SP3HVM": "ami-050f5170e43607893", "SLES12SP3SAPBYOSHVM": "ami-046ba88845aa11793", "SLES12SP3SAPHVM": "ami-04f2b176779a2ef98", "SLES12SP4HVM": "ami-01f9388175dab7707", "SLES12SP4SAPBYOSHVM": "ami-0f23448ff16bda87c", "SLES12SP4SAPHVM": "ami-0d8b573f8f345caa8", "SLES15HVM": "ami-056ac8ad44e6a7e1f", "SLES15SAPHVM": "ami-0bd8ab39c3f5e7537", "SLES15SAPBYOSHVM": "ami-0a283a879655ea8ad"}, "ap-northeast-2": {"RHEL75SAPHVM": "ami-06db50be1842d6b9a", "RHEL74SAPHAUSHVM": "ami-0450ac5a5b079fa41", "RHEL75SAPHAUSHVM": "ami-0521b6ebbf151e58a", "RHEL76SAPHAUSHVM": "ami-04384779af6b49648", "SLES11SP4HVM": "ami-00e7068674ce94853", "SLES12SP1HVM": "ami-1ced3972", "SLES12SP1SAPBYOSHVM": "ami-b5f928db", "SLES12SP2HVM": "ami-86d00fe8", "SLES12SP2SAPBYOSHVM": "ami-0aa17e547c74ef870", "SLES12SP2SAPHVM": "ami-241fab4a", "SLES12SP3HVM": "ami-00728f974fb4b3f2a", "SLES12SP3SAPBYOSHVM": "ami-0dae09c444db95f79", "SLES12SP3SAPHVM": "ami-0107d891c218beaa0", "SLES12SP4HVM": "ami-05114ac18a716bc1c", "SLES12SP4SAPBYOSHVM": "ami-028abd488e2c2f400", "SLES12SP4SAPHVM": "ami-075bd439957a0fb72", "SLES15HVM": "ami-0f81fff879bafe6b8", "SLES15SAPHVM": "ami-03389feccf448808b", "SLES15SAPBYOSHVM": "ami-0cc04512ca5fb8d7c"}, "ap-south-1": {"RHEL75SAPHVM": "ami-0afdd099cb4cacadf", "RHEL74SAPHAUSHVM": "ami-0167ffd4ebf2c034a", "RHEL75SAPHAUSHVM": "ami-029b2a9859384e194", "RHEL76SAPHAUSHVM": "ami-015afb3901ab40784", "SLES11SP4HVM": "ami-0bdb8670f707feabd", "SLES12SP1HVM": "ami-985226f7", "SLES12SP1SAPBYOSHVM": "ami-93c9bffc", "SLES12SP2HVM": "ami-62e39c0d", "SLES12SP2SAPBYOSHVM": "ami-074ee04de447633ed", "SLES12SP2SAPHVM": "ami-c9d0e1a6", "SLES12SP3HVM": "ami-0c1453eb750c7a5ab", "SLES12SP3SAPBYOSHVM": "ami-00831fe0c42624267", "SLES12SP3SAPHVM": "ami-07f4b7391f161620b", "SLES12SP4HVM": "ami-0e2520e97af25d4d2", "SLES12SP4SAPBYOSHVM": "ami-05651b45e99d63d02", "SLES12SP4SAPHVM": "ami-07ba35561b5bfbbf4", "SLES15HVM": "ami-01be89269d32f2a16", "SLES15SAPHVM": "ami-03b6e8ab101bbd4b7", "SLES15SAPBYOSHVM": "ami-0d5612595295301aa"}, "ap-southeast-1": {"RHEL75SAPHVM": "ami-08fc0673d9d83037a", "RHEL74SAPHAUSHVM": "ami-037dc0ec600ed1888", "RHEL75SAPHAUSHVM": "ami-05c8713dd14fa6156", "RHEL76SAPHAUSHVM": "ami-0469d4463a41ed704", "SLES11SP4HVM": "ami-021e49892145e1949", "SLES12SP1HVM": "ami-163d9b75", "SLES12SP1SAPBYOSHVM": "ami-ab0aa0c8", "SLES12SP2HVM": "ami-f1078a92", "SLES12SP2SAPBYOSHVM": "ami-0c5d434c11072f709", "SLES12SP2SAPHVM": "ami-d558203f", "SLES12SP3HVM": "ami-06190570cf455031a", "SLES12SP3SAPBYOSHVM": "ami-0a91084c1447100ed", "SLES12SP3SAPHVM": "ami-06fbabde04a3b021c", "SLES12SP4HVM": "ami-05a7bd74a593452d7", "SLES12SP4SAPBYOSHVM": "ami-07bae09461b7a3942", "SLES12SP4SAPHVM": "ami-055fa27c8fe8c3e36", "SLES15HVM": "ami-070356c21596ddc67", "SLES15SAPHVM": "ami-039627d2d6ad8870e", "SLES15SAPBYOSHVM": "ami-0701f0c9a5e645fe6"}, "ap-southeast-2": {"RHEL75SAPHVM": "ami-0a8af8e94f35319ba", "RHEL74SAPHAUSHVM": "ami-0c5b5357081c68218", "RHEL75SAPHAUSHVM": "ami-0df9dbd4828ca1166", "RHEL76SAPHAUSHVM": "ami-0356eb53cb824dc7e", "SLES11SP4HVM": "ami-0c966540b7cd84b4b", "SLES12SP1HVM": "ami-e32b1680", "SLES12SP1SAPBYOSHVM": "ami-460d0a25", "SLES12SP2HVM": "ami-197a6a7a", "SLES12SP2SAPBYOSHVM": "ami-0e9b31a7f29df983d", "SLES12SP2SAPHVM": "ami-ad41e4cf", "SLES12SP3HVM": "ami-0ccbc8eb74e84b8bd", "SLES12SP3SAPBYOSHVM": "ami-0a22e7733b93a13cd", "SLES12SP3SAPHVM": "ami-081fa0b36595ffa8e", "SLES12SP4HVM": "ami-0086939d81dda5418", "SLES12SP4SAPBYOSHVM": "ami-0de01b6abc06547bb", "SLES12SP4SAPHVM": "ami-00fcb756fbe00ebf8", "SLES15HVM": "ami-0c4245381c67efb39", "SLES15SAPHVM": "ami-0c2173af88e844629", "SLES15SAPBYOSHVM": "ami-0f5b781af42cbfa1e"}, "ca-central-1": {"RHEL75SAPHVM": "ami-010ef109ec0f43d6d", "RHEL74SAPHAUSHVM": "ami-06e94c1c4cd754fe5", "RHEL75SAPHAUSHVM": "ami-0173442cbf82d3d9f", "RHEL76SAPHAUSHVM": "ami-0c720e8ded4a6c5b0", "SLES11SP4HVM": "ami-0a89186e8d2b82307", "SLES12SP1SAPBYOSHVM": "ami-2fd4694b", "SLES12SP2HVM": "ami-d5d56ab1", "SLES12SP2SAPBYOSHVM": "ami-06c5c26336f743bf6", "SLES12SP2SAPHVM": "ami-23ca4747", "SLES12SP3HVM": "ami-0f7c9a39e20a9adea", "SLES12SP3SAPBYOSHVM": "ami-0bfb8d54b1407c64a", "SLES12SP3SAPHVM": "ami-0988b135bab749ed1", "SLES12SP4HVM": "ami-00ff1fa0fb4b09437", "SLES12SP4SAPBYOSHVM": "ami-07735575a65d9748f", "SLES12SP4SAPHVM": "ami-07c311c6621f637f1", "SLES15HVM": "ami-0c97d9b588207dad6", "SLES15SAPHVM": "ami-05f9b4a1e35e43bd8", "SLES15SAPBYOSHVM": "ami-08eec3db50798a295"}, "eu-central-1": {"RHEL75SAPHVM": "ami-0841ec948df565271", "RHEL74SAPHAUSHVM": "ami-0a38565bcb3243da0", "RHEL75SAPHAUSHVM": "ami-08f1018e2a0f26daa", "RHEL76SAPHAUSHVM": "ami-00e9db6661b279d3f", "SLES11SP4HVM": "ami-0f032693ef4319469", "SLES12SP1HVM": "ami-59699036", "SLES12SP1SAPBYOSHVM": "ami-4b6ba424", "SLES12SP2HVM": "ami-984ee9f7", "SLES12SP2SAPBYOSHVM": "ami-07966002b34bab5f7", "SLES12SP2SAPHVM": "ami-2a6463c1", "SLES12SP3HVM": "ami-0fa9bde3f3d40e5ae", "SLES12SP3SAPBYOSHVM": "ami-088e91696b7dcd30c", "SLES12SP3SAPHVM": "ami-01cdd8aeedf0bb409", "SLES12SP4HVM": "ami-00f695136e33f2fe0", "SLES12SP4SAPBYOSHVM": "ami-0e6f5d8c7423fbf99", "SLES12SP4SAPHVM": "ami-01a967d8b5d14c424", "SLES15HVM": "ami-05dfd265ea534a3e9", "SLES15SAPHVM": "ami-0a9dd171490b51cd7", "SLES15SAPBYOSHVM": "ami-0c3196786bb2ef35a"}, "eu-west-1": {"RHEL75SAPHVM": "ami-04a014a7d626b3fd8", "RHEL74SAPHAUSHVM": "ami-0af3e97778546f34b", "RHEL75SAPHAUSHVM": "ami-0dfa47f27b3bf9922", "RHEL76SAPHAUSHVM": "ami-0e39a11a4694e879d", "SLES11SP4HVM": "ami-0a40ff0e3202c10e1", "SLES12SP1HVM": "ami-b197d9c2", "SLES12SP1SAPBYOSHVM": "ami-81025de7", "SLES12SP2HVM": "ami-f5776f93", "SLES12SP2SAPBYOSHVM": "ami-083a4aebd9d24276c", "SLES12SP2SAPHVM": "ami-fa0c1e10", "SLES12SP3HVM": "ami-06bc7889ee68f279e", "SLES12SP3SAPBYOSHVM": "ami-0461814360323e368", "SLES12SP3SAPHVM": "ami-06ef609642514a5dc", "SLES12SP4HVM": "ami-0b27edba737a4a44a", "SLES12SP4SAPBYOSHVM": "ami-0a850f691a934ad5e", "SLES12SP4SAPHVM": "ami-01d01dc863c191b8a", "SLES15HVM": "ami-0a58a1b152ba55f1d", "SLES15SAPHVM": "ami-0ec57b29c8be369fe", "SLES15SAPBYOSHVM": "ami-032a80d78e21d81a3"}, "eu-west-2": {"RHEL75SAPHVM": "ami-070b8ef548695f653", "RHEL74SAPHAUSHVM": "ami-005b4b0f0decc3229", "RHEL75SAPHAUSHVM": "ami-0d24c16fec55a94f4", "RHEL76SAPHAUSHVM": "ami-0aeabd574eb91aa0b", "SLES11SP4HVM": "ami-06a87787f9466fa7b", "SLES12SP1SAPBYOSHVM": "ami-b2a1abd6", "SLES12SP2HVM": "ami-d97066bd", "SLES12SP2SAPBYOSHVM": "ami-0e77c12686f306f46", "SLES12SP2SAPHVM": "ami-2992794e", "SLES12SP3HVM": "ami-0eb4bd78fba2f32e4", "SLES12SP3SAPBYOSHVM": "ami-04e2fe477c0a1411f", "SLES12SP3SAPHVM": "ami-00549ed02ae342143", "SLES12SP4HVM": "ami-01016d5a2f759e80e", "SLES12SP4SAPBYOSHVM": "ami-0ac859e29f5094204", "SLES12SP4SAPHVM": "ami-03b9fb1974bc90cd0", "SLES15HVM": "ami-01497522185aaa4ee", "SLES15SAPHVM": "ami-0145366483b54a483", "SLES15SAPBYOSHVM": "ami-06f2df89214f6ead9"}, "eu-west-3": {"RHEL75SAPHVM": "ami-0b9d6c1ae0e94e8a9", "RHEL74SAPHAUSHVM": "ami-01f114d111cc45831", "RHEL75SAPHAUSHVM": "ami-0d0e00736cd23369b", "RHEL76SAPHAUSHVM": "ami-0c1cf4ecf66e353e8", "SLES11SP4HVM": "ami-036671c4b09355867", "SLES12SP1SAPBYOSHVM": "ami-cf992eb2", "SLES12SP2SAPBYOSHVM": "ami-0664ede0d13c0c473", "SLES12SP2SAPHVM": "ami-bfbf0fc2", "SLES12SP3HVM": "ami-07b20332d54ed21e8", "SLES12SP3SAPBYOSHVM": "ami-033b4942a6ba88005", "SLES12SP3SAPHVM": "ami-0ad053b84386d8e9e", "SLES12SP4HVM": "ami-077db4bb21fe102b3", "SLES12SP4SAPBYOSHVM": "ami-0c63b2bb6afc549b4", "SLES12SP4SAPHVM": "ami-0417fe5961e6aff7d", "SLES15HVM": "ami-0f238bd4c6fdbefb0", "SLES15SAPHVM": "ami-053241e65cda017f6", "SLES15SAPBYOSHVM": "ami-0f842e919e4e4eb6a"}, "sa-east-1": {"RHEL75SAPHVM": "ami-0a9ee704defec0845", "RHEL74SAPHAUSHVM": "ami-04450cf66c6bf5f42", "RHEL75SAPHAUSHVM": "ami-0fb635cae4f8c6028", "RHEL76SAPHAUSHVM": "ami-0c60751a062c4295b", "SLES11SP4HVM": "ami-00134f83806a20f4a", "SLES12SP1HVM": "ami-ce3aa7a2", "SLES12SP1SAPBYOSHVM": "ami-eb543187", "SLES12SP2HVM": "ami-52a4cf3e", "SLES12SP2SAPBYOSHVM": "ami-046181f67382fdd53", "SLES12SP2SAPHVM": "ami-5cd5f230", "SLES12SP3HVM": "ami-0188b2a9dc0ae5f44", "SLES12SP3SAPBYOSHVM": "ami-0ec3fee2bd8133f91", "SLES12SP3SAPHVM": "ami-09e61be8a308aefa1", "SLES12SP4HVM": "ami-022eaa5bbc1e2f47a", "SLES12SP4SAPBYOSHVM": "ami-0451db96691925d3b", "SLES12SP4SAPHVM": "ami-03e520b1118f74693", "SLES15HVM": "ami-0772af912976aa692", "SLES15SAPHVM": "ami-01542cd6905dc41f8", "SLES15SAPBYOSHVM": "ami-0a374c04d3223b56d"}, "us-east-1": {"RHEL75SAPHVM": "ami-05cd8f1730c8df7dc", "RHEL74SAPHAUSHVM": "ami-0f458a41a777ef497", "RHEL75SAPHAUSHVM": "ami-0d81d8964ccf8bdef", "RHEL76SAPHAUSHVM": "ami-054a9dc6c144331a0", "SLES11SP4HVM": "ami-05b47745292b62b8e", "SLES12SP1HVM": "ami-1eeab909", "SLES12SP1SAPBYOSHVM": "ami-7dd2256b", "SLES12SP2HVM": "ami-8fac8399", "SLES12SP2SAPBYOSHVM": "ami-006668674e5150470", "SLES12SP2SAPHVM": "ami-1c477763", "SLES12SP3HVM": "ami-03adb8813ffd80f0b", "SLES12SP3SAPBYOSHVM": "ami-09e515a2f58fc7a93", "SLES12SP3SAPHVM": "ami-004b5b84ba4775620", "SLES12SP4HVM": "ami-0787571b4033204ad", "SLES12SP4SAPBYOSHVM": "ami-0f9b20b9789585aa4", "SLES12SP4SAPHVM": "ami-091ab20c55fcdbe0d", "SLES15HVM": "ami-0b1764f3d7d2e2316", "SLES15SAPHVM": "ami-0e93271b8bd77b924", "SLES15SAPBYOSHVM": "ami-0b335002243e5a9ff"}, "us-east-2": {"RHEL75SAPHVM": "ami-0b1439383ea0d0c87", "RHEL74SAPHAUSHVM": "ami-0cfab53d572d62388", "RHEL75SAPHAUSHVM": "ami-03527d73c82921684", "RHEL76SAPHAUSHVM": "ami-02bf9176554430b2a", "SLES11SP4HVM": "ami-0d984fc673fefcb8c", "SLES12SP1HVM": "ami-85075de0", "SLES12SP1SAPBYOSHVM": "ami-ac2401c9", "SLES12SP2HVM": "ami-f990b69c", "SLES12SP2SAPBYOSHVM": "ami-0312e837f2f3e7ed3", "SLES12SP2SAPHVM": "ami-e10c3784", "SLES12SP3HVM": "ami-0479b39f2d07530fb", "SLES12SP3SAPBYOSHVM": "ami-03dcbd3a0a73c3e1c", "SLES12SP3SAPHVM": "ami-081afa1d3de3a3469", "SLES12SP4HVM": "ami-0f24364ccc4040c21", "SLES12SP4SAPBYOSHVM": "ami-0b4e01a990b03a9ae", "SLES12SP4SAPHVM": "ami-0220a71e17d4148ae", "SLES15HVM": "ami-05ea824317ffc0c20", "SLES15SAPHVM": "ami-038719793bd4558b1", "SLES15SAPBYOSHVM": "ami-00ee7014fa39c34cd"}, "us-west-1": {"RHEL75SAPHVM": "ami-015c680b92b8f8e04", "RHEL74SAPHAUSHVM": "ami-0bce690da8c3f9573", "RHEL75SAPHAUSHVM": "ami-09294cb9917bcb535", "RHEL76SAPHAUSHVM": "ami-05163897ae5e64145", "SLES11SP4HVM": "ami-07db9616cb48eef6e", "SLES12SP1HVM": "ami-a12962c1", "SLES12SP1SAPBYOSHVM": "ami-4a9dcf2a", "SLES12SP2HVM": "ami-32c8e552", "SLES12SP2SAPBYOSHVM": "ami-039ae8bf416dc3bde", "SLES12SP2SAPHVM": "ami-5f64873c", "SLES12SP3HVM": "ami-05561250b8346a707", "SLES12SP3SAPBYOSHVM": "ami-0f7b3754a9689ddfa", "SLES12SP3SAPHVM": "ami-081e62a74b0decab1", "SLES12SP4HVM": "ami-0afb3187a37661b18", "SLES12SP4SAPBYOSHVM": "ami-04e84846cf5b2eceb", "SLES12SP4SAPHVM": "ami-0ad4f9bec03d2763e", "SLES15HVM": "ami-00e34a7624e5a7107", "SLES15SAPHVM": "ami-026f5834b4f2f6235", "SLES15SAPBYOSHVM": "ami-039fb1d14e2287565"}, "us-west-2": {"RHEL75SAPHVM": "ami-07894ab0a4a5e8612", "RHEL74SAPHAUSHVM": "ami-050890ecc1851620c", "RHEL75SAPHAUSHVM": "ami-07f49a6a84d94211e", "RHEL76SAPHAUSHVM": "ami-0062814abe5ca3369", "SLES11SP4HVM": "ami-09a652af9ed1e0dad", "SLES12SP1HVM": "ami-7fa2061f", "SLES12SP1SAPBYOSHVM": "ami-68922c08", "SLES12SP2HVM": "ami-da786da3", "SLES12SP2SAPBYOSHVM": "ami-057a6cd34fc874a04", "SLES12SP2SAPHVM": "ami-7bb5e603", "SLES12SP3HVM": "ami-015ee9a0398544b09", "SLES12SP3SAPBYOSHVM": "ami-02df08fd0856d266b", "SLES12SP3SAPHVM": "ami-0e92a9cb236c63db2", "SLES12SP4HVM": "ami-0a3c873f21d686544", "SLES12SP4SAPBYOSHVM": "ami-042663489704d9c3f", "SLES12SP4SAPHVM": "ami-08c171bce200f50ae", "SLES15HVM": "ami-0f1e3b3fb0fec0361", "SLES15SAPHVM": "ami-01702d69a47539f9a", "SLES15SAPBYOSHVM": "ami-08c05da8c43e5091a"}}}, "Outputs": {"HANAMasterInstanceIP": {"Description": "HANA Master Node IP Address", "Value": {"Fn::GetAtt": ["HANAMasterInstance", "PrivateIp"]}}, "HANAMasterSecurityGroup": {"Description": "Security Group created for the SAP HANA Master node", "Value": {"Fn::GetAtt": ["HANASecurityGroup", "GroupId"]}}, "HANAMasterInstanceRole": {"Description": "Instance Role Name for HANA Instance", "Value": {"Ref": "HANAIAMRole"}}, "HANAMasterInstanceId": {"Description": "Instance Id for HANA Instance", "Value": {"Ref": "HANAMasterInstance"}}}, "Resources": {"Trail": {"DependsOn": ["BucketPolicy"], "Type": "AWS::CloudTrail::Trail", "Condition": "IfLogging", "Properties": {"IncludeGlobalServiceEvents": "true", "S3BucketName": {"Ref": "CloudTrailS3Bucket"}, "SnsTopicName": {"Ref": "AWS::NoValue"}, "IsLogging": "true"}}, "BucketPolicy": {"Type": "AWS::S3::BucketPolicy", "Condition": "IfLogging", "Properties": {"Bucket": {"Ref": "CloudTrailS3Bucket"}, "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Sid": "AWSCloudTrailAclCheck20150319", "Effect": "Allow", "Principal": {"Service": "cloudtrail.amazonaws.com"}, "Action": "s3:GetBucketAcl", "Resource": {"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "CloudTrailS3Bucket"}]]}}, {"Sid": "AWSCloudTrailWrite20150319", "Effect": "Allow", "Principal": {"Service": "cloudtrail.amazonaws.com"}, "Action": "s3:PutObject", "Resource": {"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "CloudTrailS3Bucket"}, "/AWSLogs/", {"Ref": "AWS::AccountId"}, "/*"]]}, "Condition": {"StringEquals": {"s3:x-amz-acl": "bucket-owner-full-control"}}}, {"Sid": "AWSConfigBucketPermissionsCheck", "Effect": "Allow", "Principal": {"Service": ["config.amazonaws.com"]}, "Action": "s3:GetBucketAcl", "Resource": {"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "CloudTrailS3Bucket"}]]}}, {"Sid": " AWSConfigBucketDelivery", "Effect": "Allow", "Principal": {"Service": ["config.amazonaws.com"]}, "Action": "s3:PutObject", "Resource": {"Fn::Join": ["", ["arn:aws:s3:::", {"Ref": "CloudTrailS3Bucket"}, "/AWSLogs/", {"Ref": "AWS::AccountId"}, "/Config/*"]]}, "Condition": {"StringEquals": {"s3:x-amz-acl": "bucket-owner-full-control"}}}]}}}, "ConfigRecorder": {"DependsOn": ["AWSConfigIAMRole"], "Type": "AWS::Config::ConfigurationRecorder", "Condition": "IfLogging", "Properties": {"Name": "HANAQuickStart-ConfigRecord", "RecordingGroup": {"ResourceTypes": ["AWS::S3::Bucket", "AWS::CloudTrail::Trail", "AWS::EC2::Instance", "AWS::EC2::SecurityGroup", "AWS::EC2::NetworkInterface", "AWS::EC2::Volume", "AWS::EC2::VPC", "AWS::EC2::Subnet", "AWS::EC2::RouteTable", "AWS::EC2::NetworkAcl"]}, "RoleARN": {"Fn::GetAtt": ["AWSConfigIAMRole", "Arn"]}}}, "DeliveryChannel": {"Type": "AWS::Config::DeliveryChannel", "Condition": "IfLogging", "Properties": {"ConfigSnapshotDeliveryProperties": {"DeliveryFrequency": "One_Hour"}, "S3BucketName": {"Ref": "CloudTrailS3Bucket"}}}, "AWSConfigIAMRole": {"Type": "AWS::IAM::Role", "Condition": "IfLogging", "Properties": {"Path": "/", "ManagedPolicyArns": ["arn:aws:iam::aws:policy/service-role/AWSConfigRole"], "AssumeRolePolicyDocument": {"Statement": [{"Effect": "Allow", "Principal": {"Service": ["config.amazonaws.com"]}, "Action": ["sts:AssumeRole"]}]}}}, "DeploymentInterruptQ": {"Type": "AWS::SQS::Queue", "Properties": {"DelaySeconds": 0, "VisibilityTimeout": 0}}, "HANAMasterInterface": {"Type": "AWS::EC2::NetworkInterface", "Properties": {"Description": "Network Interface for HANA Master", "SubnetId": {"Ref": "HANASubnet"}, "GroupSet": [{"Ref": "HANASecurityGroup"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANAWorker1Interface": {"Type": "AWS::EC2::NetworkInterface", "Condition": "TwoOrMoreNodes", "Properties": {"SubnetId": {"Ref": "HANASubnet"}, "Description": "Interface for HANA Worker 1", "GroupSet": [{"Ref": "HANASlaveSG"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANAWorker2Interface": {"Type": "AWS::EC2::NetworkInterface", "Condition": "ThreeOrMoreNodes", "Properties": {"SubnetId": {"Ref": "HANASubnet"}, "Description": "Interface for HANA Worker 2", "GroupSet": [{"Ref": "HANASlaveSG"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANAWorker3Interface": {"Type": "AWS::EC2::NetworkInterface", "Condition": "FourOrMoreNodes", "Properties": {"SubnetId": {"Ref": "HANASubnet"}, "Description": "Interface for HANA Worker 3", "GroupSet": [{"Ref": "HANASlaveSG"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANAWorker4Interface": {"Type": "AWS::EC2::NetworkInterface", "Condition": "FiveOrMoreNodes", "Properties": {"SubnetId": {"Ref": "HANASubnet"}, "Description": "Interface for HANA Worker 4", "GroupSet": [{"Ref": "HANASlaveSG"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANAWorker5Interface": {"Type": "AWS::EC2::NetworkInterface", "Condition": "SixOrMoreNodes", "Properties": {"SubnetId": {"Ref": "HANASubnet"}, "Description": "Interface for HANA Worker 5", "GroupSet": [{"Ref": "HANASlaveSG"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Private"}]}}, "HANASecurityGroup": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable external access to the HANA Master and allow communication from slave instances", "VpcId": {"Ref": "VPCID"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "1", "ToPort": "65535"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "111", "ToPort": "111"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "2049", "ToPort": "2049"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "2049", "ToPort": "2049"}, {"IpProtocol": "udp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "4000", "ToPort": "4002"}, {"IpProtocol": "icmp", "CidrIp": {"Ref": "PrivSubCIDR"}, "FromPort": "-1", "ToPort": "-1"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["5", {"Ref": "SAPInstanceNum"}, "13"]]}, "ToPort": {"Fn::Join": ["", ["5", {"Ref": "SAPInstanceNum"}, "14"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "13"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "13"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "15"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "15"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "17"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "17"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "41"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "44"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["80", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["80", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "09"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "09"]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": {"Fn::Join": ["", ["43", {"Ref": "SAPInstanceNum"}, ""]]}, "ToPort": {"Fn::Join": ["", ["43", {"Ref": "SAPInstanceNum"}, ""]]}}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": "8080", "ToPort": "8080"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": "8443", "ToPort": "8443"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": "1128", "ToPort": "1128"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": "1129", "ToPort": "1129"}, {"IpProtocol": "tcp", "CidrIp": {"Ref": "DMZCIDR"}, "FromPort": "22", "ToPort": "22"}], "SecurityGroupEgress": [{"IpProtocol": "-1", "CidrIp": "0.0.0.0/0", "FromPort": "1", "ToPort": "65535"}]}}, "HANASecurityGroupUpdate": {"Type": "AWS::EC2::SecurityGroupIngress", "Condition": "IfAppSubnet", "Properties": {"CidrIp": {"Ref": "ApplicationCIDR"}, "Description": "SAP Client Traffic", "IpProtocol": "tcp", "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "13"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "17"]]}, "GroupId": {"Ref": "HANASecurityGroup"}}}, "HANASlaveSG": {"Type": "AWS::EC2::SecurityGroup", "Condition": "TwoOrMoreNodes", "Properties": {"GroupDescription": "Enable communication between the master and slave instances", "VpcId": {"Ref": "VPCID"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "1", "ToPort": "65535", "CidrIp": {"Ref": "PrivSubCIDR"}}, {"IpProtocol": "tcp", "FromPort": {"Fn::Join": ["", ["5", {"Ref": "SAPInstanceNum"}, "13"]]}, "ToPort": {"Fn::Join": ["", ["5", {"Ref": "SAPInstanceNum"}, "14"]]}, "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "15"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "15"]]}, "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "17"]]}, "ToPort": {"Fn::Join": ["", ["3", {"Ref": "SAPInstanceNum"}, "17"]]}, "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": "1128", "ToPort": "1129", "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": "8080", "ToPort": "8080", "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": "8443", "ToPort": "8443", "CidrIp": {"Ref": "DMZCIDR"}}, {"IpProtocol": "tcp", "FromPort": "22", "ToPort": "22", "CidrIp": {"Ref": "DMZCIDR"}}], "SecurityGroupEgress": [{"IpProtocol": "-1", "FromPort": "1", "ToPort": "65535", "CidrIp": "0.0.0.0/0"}]}}, "HANAIAMRole": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Statement": [{"Effect": "Allow", "Principal": {"Service": ["ec2.amazonaws.com", "ssm.amazonaws.com"]}, "Action": ["sts:AssumeRole"]}]}, "Path": "/", "ManagedPolicyArns": ["arn:aws:iam::aws:policy/service-role/AmazonEC2RoleforSSM"], "Policies": [{"PolicyName": "HANA-QuickStart", "PolicyDocument": {"Statement": [{"Effect": "Allow", "Action": ["s3:GetObject", "s3:ListBucket", "s3:GetBucketLocation", "ec2:Describe*", "ec2:ModifyInstanceAttribute", "ec2:AttachVolume", "ec2:CreateTags", "ec2:CreateVolume"], "Resource": "*"}, {"Effect": "Allow", "Action": "cloudwatch:GetMetricStatistics", "Resource": "*"}, {"Effect": "Allow", "Action": ["sqs:*", "dynamodb:*", "dynamodb:Scan", "dynamodb:Query", "dynamodb:GetItem", "dynamodb:BatchGetItem", "dynamodb:UpdateTable", "cloudformation:DescribeStacks", "cloudformation:DescribeStackEvents", "cloudformation:DescribeStackResource", "cloudformation:DescribeStackResources", "cloudformation:GetTemplate", "cloudformation:List*"], "Resource": ["*"]}]}}]}}, "HANAIAMProfile": {"Type": "AWS::IAM::InstanceProfile", "Properties": {"Path": "/", "Roles": [{"Ref": "HANAIAMRole"}]}}, "WaitForHANAInstall": {"Type": "AWS::CloudFormation::WaitCondition", "DependsOn": "HANAMasterInstance", "Properties": {"Handle": {"Ref": "WaitForMasterInstallWaitHandle"}, "Timeout": "7200"}}, "WaitForMasterInstallWaitHandle": {"Type": "AWS::CloudFormation::WaitConditionHandle", "Properties": {}}, "RDPInstanceRootRole": {"Condition": "NeedWindowsInstance", "Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"Service": ["ec2.amazonaws.com"]}, "Action": ["sts:AssumeRole"]}]}, "Path": "/", "Policies": [{"PolicyName": "root", "PolicyDocument": {"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": ["s3:*", "ec2:Describe*", "ec2:AttachNetworkInterface", "ec2:AttachVolume", "ec2:CreateTags", "ec2:CreateVolume", "ec2:DeleteVolume", "ec2:RunInstances", "ec2:StartInstances", "ec2:CreateSecurityGroup", "ec2:CreatePlacementGroup", "ec2:CreateSnapshot"], "Resource": "*"}, {"Action": ["sqs:*"], "Effect": "Allow", "Resource": "*"}, {"Effect": "Allow", "Action": ["cloudformation:CreateStack", "cloudformation:DeleteStack", "cloudformation:DescribeStack", "cloudformation:EstimateTemplateCost", "cloudformation:ValidateTemplate", "cloudformation:DescribeStackEvents", "cloudformation:DescribeStackResource", "cloudformation:DescribeStackResources", "cloudformation:DescribeStacks"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["iam:CreateRole"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["iam:PutRolePolicy"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["iam:CreateInstanceProfile"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["iam:AddRoleToInstanceProfile"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["iam:PassRole"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["ec2:RevokeSecurityGroupEgress"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["ec2:AuthorizeSecurityGroupEgress"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["ec2:AuthorizeSecurityGroupIngress"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["ec2:CreateNetworkInterface"], "Resource": ["*"]}, {"Effect": "Allow", "Action": ["ec2:ModifyNetworkInterfaceAttribute"], "Resource": ["*"]}]}}]}}, "RDPProfile": {"Condition": "NeedWindowsInstance", "Type": "AWS::IAM::InstanceProfile", "Properties": {"Path": "/", "Roles": [{"Ref": "RDPInstanceRootRole"}]}}, "RDPSecurityGroup": {"Condition": "NeedWindowsInstance", "Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "RDP Instance security group", "VpcId": {"Ref": "VPCID"}, "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3389", "ToPort": "3389", "CidrIp": {"Ref": "RemoteAccessCIDR"}}], "SecurityGroupEgress": [{"IpProtocol": "tcp", "FromPort": "1", "ToPort": "65535", "CidrIp": "0.0.0.0/0"}]}}, "RDPEIP": {"Condition": "NeedWindowsInstance", "Type": "AWS::EC2::EIP", "Properties": {"Domain": "vpc"}}, "RDPInterface": {"Condition": "NeedWindowsInstance", "Type": "AWS::EC2::NetworkInterface", "Properties": {"SubnetId": {"Ref": "DMZSubnet"}, "Description": "Interface for RDP Instance", "GroupSet": [{"Ref": "RDPSecurityGroup"}], "SourceDestCheck": "true", "Tags": [{"Key": "Network", "Value": "Public"}]}}, "AssociateRDPEIP": {"Condition": "NeedWindowsInstance", "Type": "AWS::EC2::EIPAssociation", "Properties": {"AllocationId": {"Fn::GetAtt": ["RDPEIP", "AllocationId"]}, "NetworkInterfaceId": {"Ref": "RDPInterface"}}}, "RDPInstance": {"Condition": "NeedWindowsInstance", "Type": "AWS::EC2::Instance", "Properties": {"NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "RDPInterface"}, "DeviceIndex": "0"}], "KeyName": {"Ref": "KeyName"}, "ImageId": {"Ref": "LatestWS2012AmiId"}, "IamInstanceProfile": {"Ref": "RDPProfile"}, "Tags": [{"Key": "Name", "Value": "SAP RDP Instance (Public Subnet)"}], "InstanceType": {"Ref": "RDPInstanceType"}}}, "HANAMasterInstance": {"Type": "AWS::EC2::Instance", "Metadata": {"HostRole": "Master"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["0", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAMasterInterface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Master"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "PlacementGroup": {"Type": "AWS::EC2::PlacementGroup", "Properties": {"Strategy": "cluster"}}, "HANAWorkerInstance1": {"Type": "AWS::EC2::Instance", "Condition": "TwoOrMoreNodes", "Metadata": {"HostRole": "Worker"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["1", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAWorker1Interface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Worker 1"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "HANAWorkerInstance2": {"Type": "AWS::EC2::Instance", "Condition": "ThreeOrMoreNodes", "Metadata": {"HostRole": "Worker"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["2", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAWorker2Interface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Worker 2"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "HANAWorkerInstance3": {"Type": "AWS::EC2::Instance", "Condition": "FourOrMoreNodes", "Metadata": {"HostRole": "Worker"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["3", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAWorker3Interface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Worker 3"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "HANAWorkerInstance4": {"Type": "AWS::EC2::Instance", "Condition": "FiveOrMoreNodes", "Metadata": {"HostRole": "Worker"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["4", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAWorker4Interface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Worker 4"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "HANAWorkerInstance5": {"Type": "AWS::EC2::Instance", "Condition": "SixOrMoreNodes", "Metadata": {"HostRole": "Worker"}, "Properties": {"HostId": {"Fn::If": ["IfDedicatedHost", {"Fn::Select": ["5", {"Ref": "DedicatedHostId"}]}, {"Ref": "AWS::NoValue"}]}, "NetworkInterfaces": [{"NetworkInterfaceId": {"Ref": "HANAWorker5Interface"}, "DeviceIndex": "0"}], "PlacementGroupName": {"Fn::If": ["PlacementGroupNull", {"Ref": "AWS::NoValue"}, {"Ref": "PlacementGroupName"}]}, "KeyName": {"Ref": "KeyName"}, "BlockDeviceMappings": [{"DeviceName": "/dev/sda1", "Ebs": {"VolumeSize": "50", "VolumeType": "gp2"}}], "ImageId": {"Fn::FindInMap": ["AWSAMIRegionMap", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["SAPAMINameMap", {"Ref": "MyOS"}, "Code"]}]}, "IamInstanceProfile": {"Ref": "HANAIAMProfile"}, "Tags": [{"Key": "Name", "Value": "SAP HANA Worker 5"}], "InstanceType": {"Ref": "MyInstanceType"}}}, "AutoRecoverAlarmMaster": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryMaster", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minute.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAMasterInstance"}}]}}, "AutoRecoverAlarmWorker1": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryWorker1", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAWorkerInstance1"}}]}}, "AutoRecoverAlarmWorker2": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryWorker2", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAWorkerInstance2"}}]}}, "AutoRecoverAlarmWorker3": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryWorker3", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAWorkerInstance3"}}]}}, "AutoRecoverAlarmWorker4": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryWorker4", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAWorkerInstance4"}}]}}, "AutoRecoverAlarmWorker5": {"Type": "AWS::CloudWatch::Alarm", "Condition": "AutoRecoveryWorker5", "Properties": {"AlarmDescription": "Trigger a recovery when instance status check fails for 5 consecutive minutes.", "Namespace": "AWS/EC2", "MetricName": "StatusCheckFailed_System", "Statistic": "Minimum", "Period": "60", "EvaluationPeriods": "5", "ComparisonOperator": "GreaterThanThreshold", "Threshold": "0", "AlarmActions": [{"Fn::Join": ["", ["arn:aws:automate:", {"Ref": "AWS::Region"}, ":ec2:recover"]]}], "Dimensions": [{"Name": "InstanceId", "Value": {"Ref": "HANAWorkerInstance5"}}]}}, "EFSshared": {"Type": "AWS::EFS::FileSystem", "Properties": {"PerformanceMode": "generalPurpose", "FileSystemTags": [{"Key": "Name", "Value": {"Ref": "HANAMasterHostname"}}]}}, "EFSbackup": {"Type": "AWS::EFS::FileSystem", "Properties": {"PerformanceMode": "generalPurpose", "FileSystemTags": [{"Key": "Name", "Value": {"Ref": "HANAMasterHostname"}}]}}, "EFSMTshared": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "EFSshared"}, "SubnetId": {"Ref": "HANASubnet"}, "SecurityGroups": [{"Ref": "HANASecurityGroup"}]}}, "EFSMTbackup": {"Type": "AWS::EFS::MountTarget", "Properties": {"FileSystemId": {"Ref": "EFSbackup"}, "SubnetId": {"Ref": "HANASubnet"}, "SecurityGroups": [{"Ref": "HANASecurityGroup"}]}}}}
